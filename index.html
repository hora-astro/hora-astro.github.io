<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hora Astro Pro</title>
    <style>
        body { font-family: sans-serif; background: #f4f4f4; text-align: center; padding: 20px; }
        .card { max-width: 450px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        input, button { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        button { background: #e64a19; color: white; font-weight: bold; border: none; cursor: pointer; }
        .kundli-svg { width: 100%; height: auto; margin-top: 20px; background: #fff; }
        .rashi-num { fill: red; font-weight: bold; font-size: 16px; }
        .planet-text { fill: #333; font-size: 11px; font-weight: bold; }
    </style>
</head>
<body>

<div class="card">
    <h2>Hora Astro Pro üåå</h2>
    <input type="date" id="date" value="2006-11-06">
    <input type="time" id="time" value="11:28">
    <input type="text" id="city" value="Banswara, Rajasthan" readonly>
    <button id="btn" onclick="generate()">‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§¶‡•á‡§ñ‡•á‡§Ç</button>

    <div id="result"></div>
</div>

<script>
    async function generate() {
        const btn = document.getElementById('btn');
        btn.innerText = "‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...";
        btn.disabled = true;

        const date = document.getElementById('date').value;
        const time = document.getElementById('time').value;
        
        const url = `https://hemantpurohit27.pythonanywhere.com/get_kundli?date=${date}&time=${time}&lat=23.49&lng=74.35`;

        try {
            const r = await fetch(url);
            const data = await r.json();
            if(data.status === "success") {
                drawChart(data.asc_num, data.d1_data);
            } else {
                alert("Error: " + data.message);
            }
        } catch(e) {
            alert("‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§∏‡•á ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§™‡§æ‡§Ø‡§æ");
        } finally {
            btn.innerText = "‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§¶‡•á‡§ñ‡•á‡§Ç";
            btn.disabled = false;
        }
    }

    function drawChart(lagna, planets) {
        const coords = {
            1: [150, 90], 2: [80, 45], 3: [45, 80], 4: [95, 150],
            5: [45, 220], 6: [80, 255], 7: [150, 210], 8: [220, 255],
            9: [255, 220], 10: [205, 150], 11: [255, 80], 12: [220, 45]
        };

        let svg = `<svg viewBox="0 0 300 300" class="kundli-svg" style="border:1px solid #000">
            <line x1="0" y1="0" x2="300" y2="300" stroke="#000"/>
            <line x1="300" y1="0" x2="0" y2="300" stroke="#000"/>
            <line x1="150" y1="0" x2="0" y2="150" stroke="#000"/>
            <line x1="0" y1="150" x2="150" y2="300" stroke="#000"/>
            <line x1="150" y1="300" x2="300" y2="150" stroke="#000"/>
            <line x1="300" y1="150" x2="150" y2="0" stroke="#000"/>`;

        // ‡§∞‡§æ‡§∂‡§ø‡§Ø‡§æ‡§Å ‡§≤‡§ø‡§ñ‡•á‡§Ç
        for (let i = 1; i <= 12; i++) {
            let rashi = ((lagna + i - 2) % 12) + 1;
            svg += `<text x="${coords[i][0]}" y="${coords[i][1]}" class="rashi-num" text-anchor="middle">${rashi}</text>`;
        }

        // ‡§ó‡•ç‡§∞‡§π ‡§≤‡§ø‡§ñ‡•á‡§Ç
        const houseCounts = {};
        planets.forEach(p => {
            if(!houseCounts[p.house]) houseCounts[p.house] = 0;
            let offset = houseCounts[p.house] * 15;
            let x = coords[p.house][0];
            let y = coords[p.house][1] + 15 + offset;
            svg += `<text x="${x}" y="${y}" class="planet-text" text-anchor="middle">${p.name} ${p.degree}¬∞</text>`;
            houseCounts[p.house]++;
        });

        svg += `</svg>`;
        document.getElementById('result').innerHTML = "<h3>‡§≤‡§ó‡•ç‡§® ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä</h3>" + svg;
    }
</script>
</body>
</html>
