<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hora Astro Pro</title>
    <style>
        :root { --main: #d35400; --bg: #1a0f00; --card: #2d1d10; --text: #fdf2e9; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; }
        .container { max-width: 450px; margin: auto; }
        .header { font-size: 22px; color: var(--main); font-weight: bold; margin: 15px 0; }
        
        .card { background: var(--card); padding: 15px; border-radius: 12px; border: 1px solid #4e342e; margin-bottom: 15px; }
        input { width: 100%; padding: 12px; margin: 5px 0; border-radius: 8px; border: none; background: #3e2723; color: white; box-sizing: border-box; }
        
        .btn-load { width: 100%; padding: 15px; background: var(--main); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        
        .tab-bar { display: flex; gap: 5px; margin: 15px 0; }
        .tab { flex: 1; padding: 10px; background: #3e2723; border-radius: 8px; cursor: pointer; font-size: 13px; text-align: center; }
        .tab.active { background: var(--main); }

        /* Chart Styling - Overlap Fix */
        .chart-svg { width: 100%; background: #fff; border: 1.5px solid #000; border-radius: 5px; }
        .r-num { font-size: 16px; font-weight: bold; fill: #d32f2f; }
        .p-name { font-size: 9px; font-weight: bold; fill: #0d47a1; }

        .panchang-info { text-align: left; line-height: 1.8; }
        .panchang-item { border-bottom: 1px solid #4e342e; padding: 8px 0; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">Hora Astro Pro üåå</div>
    
    <div class="card">
        <div style="display: flex; gap: 5px;">
            <input type="date" id="date" value="2006-11-06">
            <input type="time" id="time" value="11:28">
        </div>
        <input type="text" id="city" placeholder="Banswara, Rajasthan">
        <button class="btn-load" onclick="loadData()">‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§ú‡§®‡§∞‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
    </div>

    <div class="tab-bar">
        <div class="tab active" onclick="showView('d1', this)">D1 ‡§≤‡§ó‡•ç‡§®</div>
        <div class="tab" onclick="showView('d9', this)">D9 ‡§®‡§µ‡§æ‡§Ç‡§∂</div>
        <div class="tab" onclick="showView('panchang', this)">‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó</div>
    </div>

    <div id="content-area"></div>
</div>

<script>
    async function loadData() {
        const url = `https://hemantpurohit27.pythonanywhere.com/get_kundli?date=${document.getElementById('date').value}&time=${document.getElementById('time').value}&lat=23.49&lng=74.35`;
        try {
            const res = await fetch(url);
            window.fullData = await res.json();
            showView('d1', document.querySelector('.active'));
        } catch (e) { alert("‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø!"); }
    }

    function showView(type, el) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        const area = document.getElementById('content-area');
        if(!window.fullData) return;

        if(type === 'panchang') {
            const p = window.fullData.panchang;
            area.innerHTML = `<div class="card panchang-info">
                <div class="panchang-item"><span>‡§¶‡§ø‡§®:</span> <b>${p.day}</b></div>
                <div class="panchang-item"><span>‡§™‡§ï‡•ç‡§∑:</span> <b>${p.tithi}</b></div>
                <div class="panchang-item"><span>‡§∏‡•Ç‡§∞‡•ç‡§Ø ‡§∞‡§æ‡§∂‡§ø:</span> <b>${p.sun_sign}</b></div>
                <div class="panchang-item"><span>‡§ö‡§Ç‡§¶‡•ç‡§∞ ‡§∞‡§æ‡§∂‡§ø:</span> <b>${p.moon_sign}</b></div>
            </div>`;
        } else {
            const chartData = type === 'd1' ? window.fullData.d1 : window.fullData.d9;
            area.innerHTML = `<h3 style="color:var(--main)">${type.toUpperCase()} ‡§ö‡§æ‡§∞‡•ç‡§ü</h3>` + drawChart(chartData);
        }
    }

    function drawChart(data) {
        const hPos = { 1:[150,85], 2:[75,40], 3:[40,75], 4:[95,150], 5:[40,225], 6:[75,260], 7:[150,215], 8:[225,260], 9:[260,225], 10:[205,150], 11:[260,75], 12:[225,40] };
        let svg = `<svg viewBox="0 0 300 300" class="chart-svg">
            <line x1="0" y1="0" x2="300" y2="300" stroke="#000"/><line x1="300" y1="0" x2="0" y2="300" stroke="#000"/>
            <line x1="150" y1="0" x2="0" y2="150" stroke="#000"/><line x1="0" y1="150" x2="150" y2="300" stroke="#000"/>
            <line x1="150" y1="300" x2="300" y2="150" stroke="#000"/><line x1="300" y1="150" x2="150" y2="0" stroke="#000"/>`;

        // ‡§∞‡§æ‡§∂‡§ø ‡§®‡§Ç‡§¨‡§∞ (‡§∏‡•á‡§Ç‡§ü‡§∞ ‡§Æ‡•á‡§Ç)
        for (let i = 1; i <= 12; i++) {
            let rashi = ((data.lagna + i - 2) % 12) + 1;
            svg += `<text x="${hPos[i][0]}" y="${hPos[i][1]}" class="r-num" text-anchor="middle">${rashi}</text>`;
        }

        // ‡§ó‡•ç‡§∞‡§π‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ó‡•ç‡§∞‡§ø‡§° ‡§≤‡•â‡§ú‡§ø‡§ï
        let groups = {};
        data.planets.forEach(p => {
            if(!groups[p.house]) groups[p.house] = [];
            groups[p.house].push(p);
        });

        for (let h in groups) {
            groups[h].forEach((p, idx) => {
                // 2 ‡§ï‡•â‡§≤‡§Æ ‡§Æ‡•á‡§Ç ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ (Overlap ‡§∞‡•ã‡§ï‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è)
                let col = idx % 2 === 0 ? -22 : 22;
                let row = Math.floor(idx / 2) * 11 + 15;
                if(groups[h].length === 1) col = 0; // ‡§Ö‡§ï‡•á‡§≤‡§æ ‡§ó‡•ç‡§∞‡§π ‡§∏‡•á‡§Ç‡§ü‡§∞ ‡§Æ‡•á‡§Ç

                svg += `<text x="${hPos[h][0] + col}" y="${hPos[h][1] + row}" class="p-name" text-anchor="middle">${p.name} ${p.degree}</text>`;
            });
        }
        return svg + "</svg>";
    }
</script>
</body>
</html>
