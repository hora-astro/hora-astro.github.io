<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Satik Universal Kundli</title>
    <style>
        :root { --main: #b91c1c; --bg: #fff5f5; }
        body { font-family: sans-serif; background: var(--bg); text-align: center; padding: 20px; }
        .card { background: white; max-width: 800px; margin: auto; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        svg { width: 100%; height: auto; border: 2px solid #000; background: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; font-size: 14px; }
        th { background: var(--main); color: white; }
        input, button { padding: 10px; margin: 5px; border-radius: 5px; border: 1px solid #ccc; }
        button { background: var(--main); color: white; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="card">
    <h2>॥ सटीक यूनिवर्सल कुंडली प्रो ॥</h2>
    <input type="date" id="dob" value="1980-03-27">
    <input type="time" id="tob" value="08:10">
    <input type="text" id="city" placeholder="City (Lat, Lon)" value="23.5, 74.4">
    <button onclick="getKundli()">कुंडली बनाएँ</button>

    <div class="grid" id="result" style="display:none;">
        <div id="chart-area">
            <svg id="kundliSvg" viewBox="0 0 400 400"></svg>
        </div>
        <div id="data-area">
            <table>
                <thead><tr><th>ग्रह</th><th>राशि</th><th>अंश</th></tr></thead>
                <tbody id="pTable"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
async function getKundli() {
    const [lat, lon] = document.getElementById('city').value.split(',');
    const response = await fetch('YOUR_PYTHONANYWHERE_URL/calculate', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            date: document.getElementById('dob').value,
            time: document.getElementById('tob').value,
            lat: lat.trim(),
            lon: lon.trim()
        })
    });
    const data = await response.json();
    if(data.status === 'success') {
        document.getElementById('result').style.display = 'grid';
        renderChart(data);
    }
}

function renderChart(data) {
    const svg = document.getElementById('kundliSvg');
    const asc = data.lagna_rashi;
    const pos = {1:[200,150], 2:[100,80], 3:[50,150], 4:[150,200], 5:[50,250], 6:[100,320], 7:[200,250], 8:[300,320], 9:[350,250], 10:[250,200], 11:[350,150], 12:[300,80]};
    
    let housesHtml = `<path d="M0 0 L400 400 M400 0 L0 400 M200 0 L0 200 L200 400 L400 200 Z" fill="none" stroke="red" stroke-width="2"/>`;
    
    // राशियाँ लिखना
    for(let i=1; i<=12; i++){
        let rNum = (asc + i - 1) > 12 ? (asc + i - 13) : (asc + i - 1);
        housesHtml += `<text x="${pos[i][0]}" y="${pos[i][1]}" font-size="20" fill="red" font-weight="bold">${rNum || 12}</text>`;
    }

    // ग्रह बिठाना
    data.planets.forEach(p => {
        let houseIdx = (p.rashi_idx - asc + 12) % 12 + 1;
        housesHtml += `<text x="${pos[houseIdx][0]}" y="${pos[houseIdx][1]+25}" font-size="12" fill="blue">${p.name}</text>`;
    });

    svg.innerHTML = housesHtml;
    // टेबल अपडेट
    document.getElementById('pTable').innerHTML = data.planets.map(p => `<tr><td>${p.name}</td><td>${p.rashi_idx}</td><td>${p.deg}°</td></tr>`).join('');
}
</script>
</body>
</html>
