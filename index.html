<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Saty-Vani Astro Ultimate</title>
    <style>
        :root { --maroon: #8b0000; --bg: #0f172a; }
        body { background: var(--bg); color: white; font-family: sans-serif; padding: 20px; }
        .search-box { position: relative; max-width: 600px; margin: auto; }
        #city-input { width: 100%; padding: 12px; border-radius: 5px; border: none; font-size: 16px; }
        .suggestions { 
            position: absolute; background: white; color: black; width: 100%; 
            border-radius: 0 0 5px 5px; max-height: 200px; overflow-y: auto; z-index: 100;
        }
        .suggest-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; }
        .suggest-item:hover { background: #f0f0f0; }
        
        #report { background: white; color: black; padding: 30px; margin-top: 20px; border: 5px double var(--maroon); display: none; }
        .panchang { background: #fff8e1; padding: 10px; text-align: center; font-weight: bold; margin-bottom: 15px; border: 1px solid #ffe082; }
        .chart-grid { display: flex; gap: 20px; }
        .chart { border: 2px solid var(--maroon); flex: 1; padding: 10px; background: #fff; }
    </style>
</head>
<body>

<div class="search-box">
    <h2 align="center" style="color: #fbbf24;">üïâÔ∏è ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§á‡§Ç‡§ú‡§® v2.0</h2>
    <input type="text" id="city-input" placeholder="‡§∂‡§π‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç (‡§â‡§¶‡§æ: Banswara)..." oninput="searchCity()">
    <div id="suggest-box" class="suggestions"></div>
    
    <div style="display: flex; gap: 10px; margin-top: 10px;">
        <input type="date" id="date" value="1980-03-27" style="flex:1; padding:10px;">
        <input type="time" id="time" value="08:10" style="flex:1; padding:10px;">
        <button onclick="fetchKundli()" style="background:#b45309; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; font-weight:bold;">‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§¨‡§®‡§æ‡§è‡§Å</button>
    </div>
</div>

<div id="report">
    <div class="panchang" id="panchang-info"></div>
    <div class="chart-grid">
        <div class="chart"><h3 align="center">D1 ‡§≤‡§ó‡•ç‡§®</h3><div id="d1-svg"></div></div>
        <div class="chart"><h3 align="center">D9 ‡§®‡§µ‡§æ‡§Ç‡§∂</h3><div id="d9-svg"></div></div>
    </div>
    <div id="fala-box" style="margin-top:20px; padding:15px; background:#fef2f2; border-left:5px solid var(--maroon);"></div>
</div>

<script>
    let selectedLat = 24.58, selectedLng = 73.71;

    // ‡§Æ‡•Å‡§´‡§º‡•ç‡§§ ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§∏‡§∞‡•ç‡§ö ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
    async function searchCity() {
        const query = document.getElementById('city-input').value;
        if(query.length < 3) return;
        
        const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}`);
        const data = await res.json();
        
        let html = "";
        data.forEach(item => {
            html += `<div class="suggest-item" onclick="selectCity(${item.lat}, ${item.lon}, '${item.display_name}')">${item.display_name}</div>`;
        });
        document.getElementById('suggest-box').innerHTML = html;
    }

    function selectCity(lat, lon, name) {
        selectedLat = lat; selectedLng = lon;
        document.getElementById('city-input').value = name;
        document.getElementById('suggest-box').innerHTML = "";
    }

    async function fetchKundli() {
        const d = document.getElementById('date').value;
        const t = document.getElementById('time').value;
        
        // ‡§Ö‡§™‡§®‡•á ‡§™‡§æ‡§á‡§•‡§® ‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§ï‡§æ URL ‡§Ø‡§π‡§æ‡§Å ‡§°‡§æ‡§≤‡•á‡§Ç
        const res = await fetch(`https://hemantpurohit27.pythonanywhere.com/api/final_v2?date=${d}&time=${t}&lat=${selectedLat}&lng=${selectedLng}`);
        const data = await res.json();

        document.getElementById('report').style.display = 'block';
        document.getElementById('panchang-info').innerHTML = `‡§§‡§ø‡§•‡§ø: ${data.panchang.tithi} (${data.panchang.paksha}) | ‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞: ${data.panchang.naks}`;
        
        drawKundli("d1-svg", data.asc, data.planets);
        
        // ‡§´‡§≤‡§æ‡§¶‡•á‡§∂ ‡§≤‡•â‡§ú‡§ø‡§ï
        const sun = data.planets.find(p => p.name === '‡§∏‡•Ç‡§∞‡•ç‡§Ø');
        document.getElementById('fala-box').innerHTML = `<b>‡§´‡§≤‡§æ‡§¶‡•á‡§∂:</b> ‡§Ü‡§™‡§ï‡§æ ‡§≤‡§ó‡•ç‡§® ${data.asc} ‡§π‡•à‡•§ ‡§∏‡•Ç‡§∞‡•ç‡§Ø ${sun.house}‡§µ‡•á‡§Ç ‡§≠‡§æ‡§µ ‡§Æ‡•á‡§Ç ‡§π‡•à, ‡§ú‡•ã ‡§ï‡§∞‡§ø‡§Ø‡§∞ ‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§•‡§ø‡§∞‡§§‡§æ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§`;
    }

    function drawKundli(id, asc, planets) {
        const pos = {1:[175,130], 2:[85,60], 3:[40,130], 4:[115,215], 5:[40,290], 6:[85,360], 7:[175,290], 8:[265,360], 9:[310,290], 10:[225,215], 11:[310,130], 12:[265,60]};
        let svg = `<svg viewBox="0 0 350 350" width="100%"><path d="M0 0 L350 350 M350 0 L0 350 M175 0 L0 175 L175 350 L350 175 Z" fill="none" stroke="red" stroke-width="2"/>`;
        for (let h = 1; h <= 12; h++) {
            let sign = ((asc + h - 2) % 12) + 1;
            svg += `<text x="${pos[h][0]}" y="${pos[h][1]}" fill="red" font-weight="bold" font-size="20" text-anchor="middle">${sign}</text>`;
            let pNames = planets.filter(p => p.house === h).map(p => p.name).join(' ');
            if(pNames) svg += `<text x="${pos[h][0]}" y="${pos[h][1]+30}" fill="blue" font-size="12" font-weight="bold" text-anchor="middle">${pNames}</text>`;
        }
        document.getElementById(id).innerHTML = svg + `</svg>`;
    }
</script>
</body>
</html>
