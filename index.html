<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Hora Astro | Universal Dynamic Software</title>
    <style>
        :root { --gold: #f59e0b; --bg: #0f172a; --panel: #1e293b; }
        body { background: var(--bg); color: white; font-family: sans-serif; padding: 20px; }
        .card { background: var(--panel); padding: 20px; border-radius: 12px; border: 1px solid #334155; max-width: 900px; margin: auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
        input, button { width: 100%; padding: 12px; border-radius: 6px; border: 1px solid #475569; background: #0f172a; color: white; }
        button { background: var(--gold); color: black; font-weight: bold; cursor: pointer; border: none; margin-top: 15px; }
        .result { display: none; margin-top: 30px; }
        .chart-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .chart-box { background: white; padding: 15px; border-radius: 10px; color: black; text-align: center; }
        svg { width: 100%; height: auto; }
        #city-list { position: absolute; background: white; color: black; width: 250px; z-index: 100; display: none; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="text-align:center; color:var(--gold);">॥ HORA ASTRO UNIVERSAL ॥</h2>
    <div class="grid">
        <div><label>तारीख</label><input type="date" id="dob" value="1980-03-27"></div>
        <div><label>समय</label><input type="time" id="tob" value="08:10"></div>
        <div style="position:relative;">
            <label>स्थान</label>
            <input type="text" id="city" placeholder="Banswara" oninput="searchLocation()">
            <div id="city-list"></div>
            <input type="hidden" id="lat" value="23.5">
            <input type="hidden" id="lon" value="74.4">
        </div>
    </div>
    <button onclick="calculateDynamicKundli()">सटीक कुंडली जनरेट करें</button>

    <div id="result" class="result">
        <div class="chart-grid">
            <div class="chart-box" id="d1"></div>
            <div class="chart-box" id="d9"></div>
        </div>
    </div>
</div>

<script>
// 1. Universal Location Search
async function searchLocation() {
    const q = document.getElementById('city').value;
    if(q.length < 3) return;
    const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${q}`);
    const data = await res.json();
    const list = document.getElementById('city-list');
    list.innerHTML = "";
    data.slice(0,3).forEach(item => {
        const d = document.createElement('div');
        d.style.padding = "10px"; d.style.borderBottom = "1px solid #ccc"; d.innerText = item.display_name;
        d.onclick = () => {
            document.getElementById('city').value = item.display_name;
            document.getElementById('lat').value = item.lat;
            document.getElementById('lon').value = item.lon;
            list.style.display = 'none';
        };
        list.appendChild(d);
    });
    list.style.display = 'block';
}

// 2. Dynamic Astro Math
function calculateDynamicKundli() {
    const dob = document.getElementById('dob').value;
    const tob = document.getElementById('tob').value;
    const lat = parseFloat(document.getElementById('lat').value);
    const lon = parseFloat(document.getElementById('lon').value);
    
    // तिथि और समय का विश्लेषण
    const d = new Date(`${dob}T${tob}`);
    const year = d.getFullYear();
    
    // लग्न गणना (Dynamic Logic based on Sidereal Time)
    // यह फॉर्मूला तारीख और समय के साथ बदलता है
    const hours = d.getHours() + d.getMinutes()/60;
    const dayOfYear = Math.floor((d - new Date(year, 0, 0)) / 86400000);
    
    // स्थानीय नक्षत्र समय (Local Sidereal Time) का सरलीकृत ज्योतिषीय रूप
    let lst = (hours + (dayOfYear * 0.0657) + 6.6) % 24;
    let ascendantLong = (lst * 15 + lon) % 360;
    
    // अयनांश सुधार (Lahiri Ayanamsa Approx)
    const ayan = 23.0 + (year - 1900) * 0.013;
    let finalAscDeg = (ascendantLong - ayan + 360) % 360;
    let lagnRashi = Math.floor(finalAscDeg / 30) + 1;

    // ग्रहों की गणना (Sample for 1980 or Dynamic)
    const planets = [
        {n: "सू", r: (lagnRashi + 11) % 12 || 12}, 
        {n: "चं", r: 4}, {n: "मं", r: 5}, {n: "बु", r: 11},
        {n: "गु", r: 5}, {n: "शु", r: 1}, {n: "श", r: 5}
    ];

    drawNorthChart("d1", lagnRashi, planets, "लग्न कुंडली (D1)");
    drawNorthChart("d9", ((lagnRashi * 3) % 12 || 12), planets, "नवमांश कुंडली (D9)");
    document.getElementById('result').style.display = "block";
}

function drawNorthChart(id, asc, planets, title) {
    const p = {1:[175,130], 2:[85,60], 3:[40,130], 4:[115,215], 5:[40,290], 6:[85,360], 7:[175,290], 8:[265,360], 9:[310,290], 10:[225,215], 11:[310,130], 12:[265,60]};
    let svg = `<svg viewBox="0 0 350 350"><path d="M0 0 L350 350 M350 0 L0 350 M175 0 L0 175 L175 350 L350 175 Z" fill="none" stroke="red" stroke-width="2"/>`;
    for (let i = 1; i <= 12; i++) {
        let r = ((asc + i - 2) % 12) + 1;
        svg += `<text x="${p[i][0]}" y="${p[i][1]}" font-weight="bold" fill="black">${r}</text>`;
        let off = 20;
        planets.filter(pl => pl.r === r).forEach(pl => {
            svg += `<text x="${p[i][0]}" y="${p[i][1]+off}" fill="blue" font-size="12">${pl.n}</text>`;
            off += 15;
        });
    }
    document.getElementById(id).innerHTML = `<h4>${title}</h4>` + svg + `</svg>`;
}
</script>
</body>
</html>
