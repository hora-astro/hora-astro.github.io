<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>AstroPro Accuracy - हेमंत पुरोहित</title>
    <style>
        :root { --main: #7c2d12; --bg: #fffcf5; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); padding: 15px; text-align: center; }
        .input-box { background: white; border: 2px solid var(--main); padding: 20px; border-radius: 10px; display: inline-block; margin-bottom: 20px; }
        input, button { padding: 10px; margin: 5px; border: 1px solid var(--main); border-radius: 5px; }
        button { background: var(--main); color: white; font-weight: bold; cursor: pointer; }
        .grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
        .chart-box { background: white; border: 2px solid var(--main); padding: 10px; border-radius: 8px; width: 360px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
        th, td { border: 1px solid var(--main); padding: 8px; font-size: 14px; }
        th { background: var(--main); color: white; }
        svg { width: 100%; height: auto; }
    </style>
</head>
<body>

    <div class="input-box">
        <h2 style="color:var(--main);">॥ अचूक ज्योतिष गणना ॥</h2>
        <input type="text" id="city" value="Banswara" placeholder="शहर का नाम">
        <input type="date" id="dob" value="1980-03-27">
        <input type="time" id="tob" value="10:30">
        <button onclick="calculate()">कुंडली देखें</button>
    </div>

    <div id="results" style="display:none;">
        <div class="grid">
            <div class="chart-box"><h3>लग्न कुंडली (D1)</h3><div id="d1"></div></div>
            <div class="chart-box"><h3>नवांश कुंडली (D9)</h3><div id="d9"></div></div>
        </div>
        <div class="input-box" style="width: 90%; max-width: 800px;">
            <h3>ग्रह स्पष्टीकरण (Siderial Lahiri)</h3>
            <table id="pTable"></table>
        </div>
    </div>

<script>
async function calculate() {
    let city = document.getElementById('city').value;
    let lat = 23.58, lon = 74.44; // Default Banswara
    
    try {
        const geo = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${city}`);
        const data = await geo.json();
        if(data.length > 0) { lat = data[0].lat; lon = data[0].lon; }
    } catch(e) {}

    const response = await fetch('https://hemantpurohit27.pythonanywhere.com/calculate', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            date: document.getElementById('dob').value,
            time: document.getElementById('tob').value,
            lat: lat, lon: lon
        })
    });

    const result = await response.json();
    if(result.status === 'success') {
        document.getElementById('results').style.display = 'block';
        renderTable(result.planets);
        drawChart('d1', result.lagna.rIdx, result.planets, 'house');
        drawChart('d9', result.lagna.d9, result.planets, 'd9');
    }
}

function renderTable(planets) {
    let html = `<tr><th>ग्रह</th><th>राशि अंश</th><th>नक्षत्र</th><th>पद</th><th>भाव</th></tr>`;
    planets.forEach(p => {
        html += `<tr><td><b>${p.name}</b></td><td>${p.deg}°</td><td>${p.nak}</td><td>${p.charan}</td><td>${p.house}</td></tr>`;
    });
    document.getElementById('pTable').innerHTML = html;
}

function drawChart(id, asc, planets, key) {
    const pts = {1:[175,150], 2:[85,75], 3:[40,140], 4:[130,195], 5:[40,260], 6:[85,325], 7:[175,250], 8:[265,325], 9:[310,260], 10:[220,195], 11:[310,140], 12:[265,75]};
    let svg = `<svg viewBox="0 0 350 350"><path d="M0 0 L350 0 L350 350 L0 350 Z M0 0 L350 350 M350 0 L0 350 M175 0 L0 175 L175 350 L350 175 Z" fill="none" stroke="#7c2d12" stroke-width="2"/>`;
    for(let i=1; i<=12; i++) {
        let r = (asc + i - 1); if(r > 12) r -= 12;
        svg += `<text x="${pts[i][0]}" y="${pts[i][1]}" fill="#b91c1c" font-size="22" font-weight="bold" text-anchor="middle">${r}</text>`;
        let inH = (key === 'house') ? planets.filter(p => p.house === i) : planets.filter(p => p.d9 === r);
        inH.forEach((p, idx) => {
            svg += `<text x="${pts[i][0]}" y="${pts[i][1] + 25 + (idx*18)}" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">${p.name}</text>`;
        });
    }
    document.getElementById(id).innerHTML = svg + `</svg>`;
}
</script>
</body>
</html>
