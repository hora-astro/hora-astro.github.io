<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Kundli Generator</title>
<style>
body{font-family:Arial;padding:20px}
.box{border:1px solid #ccc;padding:15px;margin-top:10px;border-radius:10px}
table{border-collapse:collapse;width:100%}
td,th{border:1px solid #ccc;padding:6px}
</style>
</head>

<body>

<h2>Kundli Generator</h2>

<div class="box">
Date of Birth:
<input id="dob" type="date"><br><br>

Time of Birth:
<input id="tob" type="time"><br><br>

Birth Place (Lat, Lon):
<input id="lat" placeholder="23.4">
<input id="lon" placeholder="74.3"><br><br>

<button onclick="getKundli()">Get Kundli</button>
<button onclick="getPDF()">Download PDF</button>
</div>


<div id="result" class="box" style="display:none">

<h3 id="lagna"></h3>

<h4>D1 Chart</h4>
<pre id="d1"></pre>

<h4>D9 Chart</h4>
<pre id="d9"></pre>

<h4>Planets</h4>
<table id="planetTable"></table>

<h4>Panchang</h4>
<pre id="panchang"></pre>

<h4>Vimshottari Dasha</h4>
<table id="dashaTable"></table>

</div>


<script>

const API = "https://hemantpurohit27.pythonanywhere.com";

async function getKundli(){

 let payload = {
   dob: dob.value,
   tob: tob.value,
   lat: lat.value,
   lon: lon.value
 }

 let res = await fetch(API+"/api/kundli",{
   method:"POST",
   headers:{'Content-Type':'application/json'},
   body:JSON.stringify(payload)
 });

 let k = await res.json();

 lagna.innerText = "Lagna: "+k.lagna;

 d1.innerText = JSON.stringify(k.d1_chart,null,2);
 d9.innerText = JSON.stringify(k.d9_chart,null,2);

 planetTable.innerHTML =
  "<tr><th>Planet</th><th>Sign</th><th>Degree</th></tr>" +
  k.planets.map(p=>`<tr>
   <td>${p.planet}</td>
   <td>${p.sign}</td>
   <td>${p.degree}</td>
  </tr>`).join("");

 panchang.innerText = JSON.stringify(k.panchang,null,2);

 dashaTable.innerHTML =
   k.vimshottari.map(r=>`
   <tr><td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td></tr>
   `).join("");

 result.style.display="block";
}



async function getPDF(){

 let payload = {
   dob: dob.value,
   tob: tob.value,
   lat: lat.value,
   lon: lon.value
 }

 let res = await fetch(API+"/api/pdf",{
   method:"POST",
   headers:{'Content-Type':'application/json'},
   body:JSON.stringify(payload)
 });

 let blob = await res.blob();
 let url = window.URL.createObjectURL(blob);
 window.open(url);
}

</script>

</body>
</html>
