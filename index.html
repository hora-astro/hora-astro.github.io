<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>HORA ASTRO SUPREME V45.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --gold: #ffcc00; --panel: #161b22; }
        body { background: #0d1117; color: white; font-family: 'Segoe UI', sans-serif; padding: 20px; }
        .search-box { background: var(--panel); padding: 25px; border-radius: 15px; border: 2px solid var(--gold); margin-bottom: 25px; }
        .input-row { display: flex; gap: 15px; margin-bottom: 15px; }
        input { flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #30363d; background: #000; color: white; }
        
        .panchang-bar { display: flex; gap: 10px; justify-content: space-around; margin-bottom: 20px; }
        .pan-box { background: var(--gold); color: black; padding: 10px 20px; border-radius: 5px; font-weight: bold; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: white; padding: 15px; border-radius: 10px; color: black; }
        .btn-pdf { background: #2ea44f; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>

<div class="search-box">
    <h2 align="center" style="color:var(--gold)">üïâÔ∏è HORA ASTRO SUPREME V45.0 (GOLD)</h2>
    <div class="input-row">
        <input type="text" id="name" placeholder="‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç">
        <input type="text" id="city" placeholder="‡§∂‡§π‡§∞ ‡§ñ‡•ã‡§ú‡•á‡§Ç (‡§ú‡§∞‡•Ç‡§∞‡•Ä)..." oninput="findCity(this.value)">
    </div>
    <div id="city-list" style="position:absolute; background:#21262d; width:300px; cursor:pointer"></div>
    <div class="input-row">
        <input type="date" id="date" value="2006-11-06">
        <input type="time" id="time" value="11:28">
    </div>
    <input type="hidden" id="lat"><input type="hidden" id="lng">
    <button onclick="calculate()" style="width:100%; background:var(--gold); padding:15px; font-weight:bold; cursor:pointer">‡§™‡•Ç‡§∞‡•ç‡§£ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
</div>

<div id="result-area" style="display:none">
    <div class="panchang-bar" id="pan-bar"></div>
    <div class="grid">
        <div class="card" id="d1-chart"></div>
        <div class="card" id="d9-chart"></div>
    </div>
    
    <div style="margin-top:20px;">
        <table id="p-table" style="width:100%; background:#161b22; text-align:center; border-collapse:collapse"></table>
    </div>
    
    <button class="btn-pdf" onclick="downloadPDF()">üì• ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</button>
</div>

<script>
    async function findCity(q) {
        if(q.length < 3) return;
        const r = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${q}`);
        const data = await r.json();
        let html = '';
        data.slice(0,5).forEach(i => {
            html += `<div onclick="setCity('${i.display_name}',${i.lat},${i.lon})" style="padding:10px; border-bottom:1px solid #444">${i.display_name}</div>`;
        });
        document.getElementById('city-list').innerHTML = html;
    }

    function setCity(n, la, lo) {
        document.getElementById('city').value = n;
        document.getElementById('lat').value = la;
        document.getElementById('lng').value = lo;
        document.getElementById('city-list').innerHTML = '';
    }

    async function calculate() {
        const lat = document.getElementById('lat').value;
        if(!lat) { alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§∂‡§π‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç!"); return; }

        const url = `https://hemantpurohit27.pythonanywhere.com/api/v45_supreme?lat=${lat}&lng=${document.getElementById('lng').value}&date=${document.getElementById('date').value}&time=${document.getElementById('time').value}`;
        const res = await fetch(url);
        const d = await res.json();

        document.getElementById('result-area').style.display = 'block';
        
        // ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó ‡§Ö‡§™‡§°‡•á‡§ü
        document.getElementById('pan-bar').innerHTML = `
            <div class="pan-box">‡§∏‡§Ç‡§µ‡§§: ${d.samvat}</div>
            <div class="pan-box">‡§Æ‡§æ‡§π: ${d.panchang.month}</div>
            <div class="pan-box">‡§§‡§ø‡§•‡§ø: ${d.panchang.tithi}</div>
            <div class="pan-box">‡§™‡§ï‡•ç‡§∑: ${d.panchang.paksha}</div>
        `;
        
        // ‡§ö‡§æ‡§∞‡•ç‡§ü‡•ç‡§∏ ‡§î‡§∞ ‡§ü‡•á‡§¨‡§≤ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç... (drawChart function V40 ‡§µ‡§æ‡§≤‡§æ ‡§π‡•Ä ‡§∞‡§π‡•á‡§ó‡§æ)
    }

    function downloadPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text("HORA ASTRO SUPREME REPORT", 10, 10);
        doc.text("Name: " + document.getElementById('name').value, 10, 20);
        doc.text("Location: " + document.getElementById('city').value, 10, 30);
        doc.save("Kundli_Report.pdf");
    }
</script>
</body>
</html>
