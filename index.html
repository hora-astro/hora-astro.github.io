<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Professional Astro Report</title>
    <style>
        :root { --main: #7c2d12; }
        body { font-family: sans-serif; margin: 0; background: #eee; }
        .nav { background: white; padding: 15px; text-align: center; border-bottom: 4px solid var(--main); position: sticky; top:0; z-index:100; }
        .input-group { display: inline-block; margin: 5px; text-align: left; }
        .input-group label { display: block; font-size: 12px; font-weight: bold; }
        .page { width: 210mm; background: white; margin: 20px auto; padding: 15mm; min-height: 297mm; }
        .chart-grid { display: flex; justify-content: center; margin: 20px 0; }
        svg { width: 320px; height: 320px; border: 2px solid var(--main); }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid var(--main); padding: 8px; text-align: center; }
        button { background: var(--main); color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 4px; }
    </style>
</head>
<body>

<div class="nav">
    <div class="input-group"><label>नाम</label><input type="text" id="uname" value="हेमंत पुरोहित"></div>
    <div class="input-group"><label>जन्म तिथि</label><input type="date" id="dob" value="1980-03-27"></div>
    <div class="input-group"><label>समय</label><input type="time" id="tob" value="10:30"></div>
    <div class="input-group"><label>Lat (अक्षांश)</label><input type="number" id="lat" value="23.55" step="0.01"></div>
    <div class="input-group"><label>Lon (देशांतर)</label><input type="number" id="lon" value="74.44" step="0.01"></div>
    <button onclick="calculate()">रिपोर्ट बनाएँ</button>
</div>

<div id="printArea">
    <div class="page" id="mainPage">
        <h2 align="center" style="color:var(--main); margin:0;">॥ सम्पूर्ण जन्म कुंडली महा-फलादेश ॥</h2>
        <p id="info" align="center"></p>
        
        <div class="chart-grid">
            <div id="d1"></div>
        </div>

        <table>
            <thead><tr><th>ग्रह</th><th>राशि</th><th>अंश</th><th>नक्षत्र</th><th>भाव</th></tr></thead>
            <tbody id="pBody"></tbody>
        </table>

        <div style="margin-top:20px; border-top:2px solid var(--main); padding-top:10px;">
            <h3>व्यक्तित्व विश्लेषण:</h3>
            <p id="predText">कृपया गणना बटन दबाएं...</p>
        </div>
    </div>
</div>

<script>
async function calculate() {
    const btn = document.querySelector('button');
    btn.innerText = "गणना हो रही है...";
    
    const payload = {
        name: document.getElementById('uname').value,
        date: document.getElementById('dob').value,
        time: document.getElementById('tob').value,
        lat: document.getElementById('lat').value,
        lon: document.getElementById('lon').value
    };

    try {
        const response = await fetch('https://hemantpurohit27.pythonanywhere.com/calculate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        const data = await response.json();
        if(data.status === 'success') {
            render(data);
        } else {
            alert("सर्वर त्रुटि: " + data.message);
        }
    } catch (error) {
        alert("कनेक्शन फेल! सुनिश्चित करें कि PythonAnywhere पर Reload बटन दबाया गया है।");
    } finally {
        btn.innerText = "रिपोर्ट बनाएँ";
    }
}

function render(data) {
    document.getElementById('info').innerText = `जातक: ${data.meta.name} | ${data.meta.date} | ${data.meta.time} | लग्न: ${data.lagna.nak}`;
    
    let html = "";
    data.planets.forEach(p => {
        html += `<tr><td>${p.name}</td><td>${p.rIdx}</td><td>${p.deg}°</td><td>${p.nak}</td><td>${p.house}</td></tr>`;
    });
    document.getElementById('pBody').innerHTML = html;

    drawDiamond('d1', data.lagna.rIdx, data.planets);
    document.getElementById('predText').innerText = `आपका जन्म ${data.lagna.nak} नक्षत्र में हुआ है। कुंडली के अनुसार आप एक प्रभावशाली व्यक्तित्व के स्वामी हैं। एकादश भाव की स्थिति आर्थिक समृद्धि का संकेत देती है।`;
}

function drawDiamond(id, asc, planets) {
    const pts = {1:[160,110], 2:[80,50], 3:[40,110], 4:[120,160], 5:[40,220], 6:[80,280], 7:[160,210], 8:[240,280], 9:[280,220], 10:[200,160], 11:[280,110], 12:[240,50]};
    let svg = `<svg viewBox="0 0 320 320"><path d="M0 0 L320 0 L320 320 L0 320 Z M0 0 L320 320 M320 0 L0 320 M160 0 L0 160 L160 320 L320 160 Z" fill="none" stroke="#7c2d12" stroke-width="2"/>`;
    for(let i=1; i<=12; i++) {
        let r = (asc + i - 1); if(r > 12) r -= 12;
        svg += `<text x="${pts[i][0]}" y="${pts[i][1]}" fill="red" font-weight="bold" font-size="16" text-anchor="middle">${r}</text>`;
        let pin = planets.filter(p => p.house === i);
        pin.forEach((p, idx) => {
            svg += `<text x="${pts[i][0]}" y="${pts[i][1] + 18 + (idx*14)}" font-size="11" font-weight="bold" text-anchor="middle" fill="#333">${p.name}</text>`;
        });
    }
    document.getElementById(id).innerHTML = svg + `</svg>`;
}
</script>
</body>
</html>
