<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Astro Professional Report</title>
    <style>
        :root { --maroon: #800000; --gold: #b8860b; }
        body { font-family: 'Segoe UI', Arial; background: #fffcf5; margin: 0; padding: 20px; }
        .config-panel { background: white; padding: 20px; border-bottom: 4px solid var(--maroon); display: flex; gap: 10px; flex-wrap: wrap; box-shadow: 0 2px 5px rgba(0,0,0,0.1); sticky; top: 0; z-index: 100; }
        .report-page { max-width: 900px; margin: 20px auto; background: white; padding: 40px; border: 1px solid #ddd; }
        .prediction-card { border-left: 5px solid var(--gold); background: #fef9e7; padding: 15px; margin: 15px 0; border-radius: 4px; }
        .high { color: green; font-weight: bold; }
        .low { color: red; font-weight: bold; }
        .suggestions { position: absolute; background: white; border: 1px solid #ccc; width: 250px; display: none; margin-top: 40px; }
        .suggestions div { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

<div class="config-panel">
    <input type="text" id="cityName" placeholder="शहर खोजें..." oninput="fetchCities(this.value)">
    <div id="cityList" class="suggestions"></div>
    <input type="hidden" id="lat"> <input type="hidden" id="lon">
    <input type="date" id="dob" value="1995-05-15">
    <input type="time" id="tob" value="10:30">
    <button onclick="startCalculation()" style="background:var(--maroon); color:white; border:none; padding:10px 20px; cursor:pointer;">कुंडली जेनरेट करें</button>
</div>

<div id="output"></div>

<script>
const LAGNA_WEBSITE_LOGIC = {
    1: { name: "मेष", yog: ["Sun", "Jupiter", "Mars"], marak: ["Venus", "Mercury", "Saturn"], desc: "मेष लग्न के स्वामी मंगल देव हैं। सूर्य यहाँ पंचमेश होकर परम राजयोग कारक बनते हैं।" },
    2: { name: "वृष", yog: ["Saturn", "Mercury", "Venus"], marak: ["Jupiter", "Moon", "Mars"], desc: "वृष लग्न का स्वामी शुक्र है। शनि यहाँ भाग्येश और कर्मेश होकर राजयोग कारक है।" },
    10: { name: "मकर", yog: ["Venus", "Mercury", "Saturn"], marak: ["Moon", "Mars", "Jupiter"], desc: "मकर लग्न का स्वामी शनि है। यहाँ शुक्र राजयोग कारक माना जाता है।" }
    // इसी तरह 3-9 और 11, 12 का डेटा जोड़ें
};

async function fetchCities(val) {
    if(val.length < 3) return;
    const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${val}`);
    const data = await res.json();
    const list = document.getElementById('cityList');
    list.innerHTML = ""; list.style.display = "block";
    data.forEach(c => {
        let d = document.createElement('div');
        d.innerText = c.display_name;
        d.onclick = () => {
            document.getElementById('lat').value = c.lat;
            document.getElementById('lon').value = c.lon;
            document.getElementById('cityName').value = c.display_name.split(',')[0];
            list.style.display = "none";
        };
        list.appendChild(d);
    });
}

async function startCalculation() {
    const output = document.getElementById('output');
    output.innerHTML = "<h3>गणना हो रही है, कृपया प्रतीक्षा करें...</h3>";

    try {
        const response = await fetch('http://hemantpurohit27.pythonanywhere.com/calculate', { // यहाँ अपना URL बदलें
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                date: document.getElementById('dob').value,
                time: document.getElementById('tob').value,
                lat: document.getElementById('lat').value || "28.61",
                lon: document.getElementById('lon').value || "77.20"
            })
        });

        const data = await response.json();
        if(data.status === 'success') renderReport(data);
        else output.innerHTML = `<h3 style="color:red">त्रुटी: ${data.message}</h3>`;
    } catch (e) {
        output.innerHTML = `<h3 style="color:red">सर्वर से संपर्क नहीं हो पाया। सुनिश्चित करें कि Backend चालू है।</h3>`;
    }
}

function renderReport(data) {
    const conf = LAGNA_WEBSITE_LOGIC[data.lagna.rIdx] || {name: "अज्ञात", desc: "", yog: [], marak: []};
    
    let html = `<div class="report-page">
        <h1 style="text-align:center; color:var(--maroon);">जन्म कुंडली प्रतिवेदन</h1>
        <p><b>लग्न:</b> ${conf.name} | <b>लहरी आयनांश:</b> ${data.ayanamsa}</p>
        <div class="prediction-card"><b>लग्न परिचय:</b> ${conf.desc}</div>`;

    data.planets.forEach(p => {
        let type = conf.yog.includes(p.id) ? "योगकारक" : (conf.marak.includes(p.id) ? "मारक" : "सम");
        let statusText = p.status ? `<span class="${p.status === 'उच्च' ? 'high' : 'low'}">(${p.status})</span>` : "";
        
        html += `<div class="prediction-card">
            <b>${p.id} ${statusText}:</b> यह आपके ${p.house} वें भाव में ${p.deg} पर स्थित है। <br>
            यह इस लग्न के लिए <b>${type}</b> ग्रह है। 
            ${p.status === 'उच्च' ? 'यह उच्च का होकर अत्यंत शुभ फल देगा।' : ''}
            ${p.status === 'नीच' ? 'यह नीच का होने के कारण संबंधित भाव में कमी कर सकता है।' : ''}
        </div>`;
    });

    document.getElementById('output').innerHTML = html + `</div>`;
}
</script>
</body>
</html>
