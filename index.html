<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>50-Page Life Report Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Arial'; background: #f4f4f4; margin: 0; }
        .toolbar { background: #800000; color: white; padding: 15px; display: flex; gap: 10px; position: sticky; top:0; z-index:100; justify-content: center; }
        .pdf-page { width: 210mm; min-height: 297mm; background: white; margin: 20px auto; padding: 20mm; box-shadow: 0 0 10px rgba(0,0,0,0.1); page-break-after: always; position: relative;}
        .prediction-box { border-left: 5px solid #daa520; background: #fffcf0; padding: 20px; margin: 20px 0; font-size: 17px; line-height: 1.8; }
        h1, h2 { color: #800000; text-align: center; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        .age-tag { background: #800000; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div class="toolbar">
    <input type="text" id="name" value="हेमंत पुरोहित">
    <input type="date" id="dob" value="1980-03-27">
    <input type="time" id="tob" value="10:30">
    <input type="text" id="lat" value="23.32" style="width:60px">
    <input type="text" id="lon" value="74.26" style="width:60px">
    <button onclick="generate50Page()">50 पेज रिपोर्ट जेनरेट करें</button>
</div>

<div id="content"></div>

<script>
const DASHA_LORDS = ["केतु", "शुक्र", "सूर्य", "चंद्र", "मंगल", "राहु", "गुरु", "शनि", "बुध"];
const DASHA_YEARS = [7, 20, 6, 10, 7, 18, 16, 19, 17];

async function generate50Page() {
    const res = await fetch('https://hemantpurohit27.pythonanywhere.com/calculate', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({date: document.getElementById('dob').value, time: document.getElementById('tob').value, lat: document.getElementById('lat').value, lon: document.getElementById('lon').value})
    });
    const data = await res.json();
    render(data);
}

function render(data) {
    let html = "";
    
    // पेज 1: मुखपृष्ठ
    html += `<div class="pdf-page"><h1>॥ वृहद जीवन फलादेश ॥</h1><h2 style="margin-top:100px;">जातक का नाम: ${document.getElementById('name').value}</h2><p style="text-align:center;">यह 50 पृष्ठों की विस्तृत रिपोर्ट आपके संपूर्ण जीवन का दर्पण है।</p></div>`;

    // पेज 2: लग्न कुंडली और ग्रह स्थिति
    html += `<div class="pdf-page"><h2>कुंडली विवरण</h2><div id="d1_svg"></div><table><tr><th>ग्रह</th><th>अंश</th><th>भाव</th></tr>`;
    data.planets.forEach(p => { html += `<tr><td>${p.name}</td><td>${p.deg}</td><td>${p.house}</td></tr>`; });
    html += `</table></div>`;

    // पेज 3-14: भावों का फलादेश (भावेश की स्थिति अनुसार)
    for(let i=1; i<=12; i++) {
        html += `<div class="pdf-page"><h2>अध्याय ${i+2}: ${i} भाव का परिणाम</h2><div class="prediction-box">इस भाव का स्वामी कुंडली में जिस स्थिति में है, वह आपके जीवन के इस क्षेत्र में महत्वपूर्ण भूमिका निभाएगा।</div></div>`;
    }

    // पेज 15-50: आयु अनुसार मिलने वाली सुविधाएं (दशा आधारित)
    let currentYear = new Date(data.dob).getFullYear();
    let dashaIdx = data.dasha_idx;
    let startAge = 0;
    
    for(let page=15; page<=50; page++) {
        let ageRangeStart = (page - 15) * 3;
        let ageRangeEnd = ageRangeStart + 3;
        let lord = DASHA_LORDS[dashaIdx % 9];

        html += `<div class="pdf-page">
            <h2>आयु विश्लेषण: ${ageRangeStart} से ${ageRangeEnd} वर्ष</h2>
            <div class="prediction-box">
                <span class="age-tag">आयु ${ageRangeStart}-${ageRangeEnd} वर्ष</span><br><br>
                इस अवधि में आप पर <b>${lord}</b> की महादशा का प्रभाव रहेगा। 
                <br><br>
                <b>मिलने वाली सुविधाएं:</b><br>
                ${ageRangeStart < 20 ? 'शिक्षा, माता का सुख और प्रारंभिक विकास के साधन मिलेंगे।' : ''}
                ${ageRangeStart >= 20 && ageRangeStart < 45 ? 'विवाह, वाहन सुख, भवन निर्माण और करियर में स्थायित्व की प्राप्ति होगी।' : ''}
                ${ageRangeStart >= 45 ? 'धार्मिक यात्राएं, संचित धन का लाभ और सामाजिक प्रतिष्ठा में वृद्धि होगी।' : ''}
                <br><br>
                <b>Fortune विश्लेषण:</b> इस आयु वर्ग में आपके ${lord} की स्थिति के कारण आपको भौतिक सुखों की प्राप्ति होगी। यदि आप व्यापार में हैं, तो विस्तार के अवसर मिलेंगे।
            </div>
        </div>`;
        if (ageRangeEnd % 10 === 0) dashaIdx++; // सरल दशा परिवर्तन लॉजिक
    }

    document.getElementById('content').innerHTML = html;
}
</script>
</body>
</html>
