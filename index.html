<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Astro Expert - FortuneWithStars Logic</title>
    <style>
        :root { --maroon: #800000; --gold: #f1c40f; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #fdfaf0; margin: 0; }
        .toolbar { background: white; padding: 20px; border-bottom: 4px solid var(--maroon); display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
        .pdf-page { width: 210mm; min-height: 297mm; background: white; margin: 20px auto; padding: 15mm; box-shadow: 0 0 15px rgba(0,0,0,0.2); }
        .panchang-box { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; background: #fff8e1; padding: 15px; border: 1px solid var(--gold); margin: 15px 0; }
        .pred-box { border-left: 6px solid var(--maroon); background: #f9f9f9; padding: 20px; margin: 20px 0; line-height: 1.8; text-align: justify; }
        .status-tag { color: red; font-weight: bold; margin-left: 5px; }
        #locationInput { width: 250px; padding: 10px; border: 1px solid #ccc; }
        .suggestions { position: absolute; background: white; border: 1px solid #ccc; width: 250px; z-index: 100; }
        .suggestion-item { padding: 8px; cursor: pointer; border-bottom: 1px solid #eee; }
        .suggestion-item:hover { background: #f0f0f0; }
    </style>
</head>
<body>

<div class="toolbar">
    <div style="position:relative;">
        <input type="text" id="locationInput" placeholder="शहर का नाम लिखें..." oninput="searchLocation(this.value)">
        <div id="suggestionBox" class="suggestions"></div>
    </div>
    <input type="date" id="dob" value="1980-03-27">
    <input type="time" id="tob" value="10:30">
    <input type="hidden" id="lat" value="23.32">
    <input type="hidden" id="lon" value="74.26">
    <button onclick="generateKundli()" style="background:var(--maroon); color:white; padding:10px 20px; border:none; cursor:pointer;">कुंडली प्राप्त करें</button>
</div>

<div id="output">
    <div class="pdf-page" id="mainPage" style="display:none;">
        <h1 style="text-align:center; color:var(--maroon);">॥ विस्तृत जन्म विवरण एवं फलादेश ॥</h1>
        
        <div class="panchang-box" id="panchang_data"></div>
        
        <div id="planetary_table"></div>
        
        <div id="lagna_prediction"></div>
        
        <div id="house_lord_prediction"></div>
    </div>
</div>

<script>
// लोकेशन सर्च लॉजिक
async function searchLocation(query) {
    if(query.length < 3) return;
    const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}`);
    const data = await res.json();
    let html = "";
    data.forEach(item => {
        html += `<div class="suggestion-item" onclick="selectLoc('${item.display_name}', ${item.lat}, ${item.lon})">${item.display_name}</div>`;
    });
    document.getElementById('suggestionBox').innerHTML = html;
}

function selectLoc(name, lat, lon) {
    document.getElementById('locationInput').value = name;
    document.getElementById('lat').value = lat;
    document.getElementById('lon').value = lon;
    document.getElementById('suggestionBox').innerHTML = "";
}

const LAGNA_WEBSITE_LOGIC = {
    1: { name: "मेष", lords: ["मंगल", "शुक्र", "बुध", "चंद्र", "सूर्य", "बुध", "शुक्र", "मंगल", "गुरु", "शनि", "शनि", "गुरु"], desc: "आप ऊर्जावान और साहसी व्यक्तित्व के स्वामी हैं। भाग्य भाव का स्वामी गुरु होने से आप धार्मिक होंगे।" },
    // इसी तरह अन्य लग्नों का डेटा यहाँ जोड़ें...
};

async function generateKundli() {
    const response = await fetch('https://hemantpurohit27.pythonanywhere.com/calculate', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            date: document.getElementById('dob').value,
            time: document.getElementById('tob').value,
            lat: document.getElementById('lat').value,
            lon: document.getElementById('lon').value
        })
    });
    const data = await response.json();
    if(data.status === 'success') renderReport(data);
}

function renderReport(data) {
    document.getElementById('mainPage').style.display = 'block';
    
    // पंचांग विवरण
    document.getElementById('panchang_data').innerHTML = `
        <div><b>राशि:</b> ${data.panchang.rashi}</div>
        <div><b>नक्षत्र:</b> ${data.panchang.nakshatra}</div>
        <div><b>चरण:</b> ${data.panchang.charan}</div>
        <div><b>लग्न:</b> ${data.panchang.lagna}</div>
    `;

    // ग्रह टेबल (उच्च-नीच चिह्न के साथ)
    let tbl = `<table><tr><th>ग्रह</th><th>अंश</th><th>भाव</th><th>स्थिति</th></tr>`;
    data.planets.forEach(p => {
        tbl += `<tr><td>${p.name}</td><td>${p.deg}</td><td>${p.house}</td><td class="status-tag">${p.status}</td></tr>`;
    });
    document.getElementById('planetary_table').innerHTML = tbl + `</table>`;

    // भावेश एवं दृष्टी फलादेश (विस्तृत)
    let hlordHtml = "<h2>भावेश एवं दृष्टि संबंध फलादेश</h2>";
    data.planets.forEach(p => {
        hlordHtml += `<div class="pred-box">
            <b>${p.name} का प्रभाव:</b> यह ग्रह ${p.house} भाव में स्थित है। 
            शास्त्रीय दृष्टि से यह अपने से सप्तम भाव पर पूर्ण दृष्टि डाल रहा है। 
            यदि यह शुभ भावों का स्वामी होकर केंद्र में है, तो FortuneWithStars के अनुसार यह जीवन में अत्यंत सुखद परिणाम देगा।
        </div>`;
    });
    document.getElementById('house_lord_prediction').innerHTML = hlordHtml;
}
</script>
</body>
</html>
