<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Astro-Omni Ultimate Pro V31.0</title>
    <style>
        :root { --accent: #ff9800; --bg: #050a10; --card: #111827; }
        body { background: var(--bg); color: #fff; font-family: 'Arial'; padding: 20px; }
        .grid-panchang { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 20px; }
        .pan-box { background: var(--card); border: 1px solid var(--accent); padding: 15px; border-radius: 8px; text-align: center; }
        .chart-container { display: flex; justify-content: space-around; background: #fff; padding: 30px; border-radius: 20px; color: #000; }
        .prediction-card { background: #1a202c; border-left: 6px solid #48bb78; padding: 20px; margin-top: 20px; border-radius: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #2d3748; padding: 12px; text-align: left; }
        th { color: var(--accent); }
    </style>
</head>
<body>

    <h2 align="center" style="color:var(--accent)">üïâÔ∏è ASTRO-OMNI PROFESSIONAL V31.0</h2>

    <div class="grid-panchang" id="panchang_ui">
        </div>

    <div class="chart-container" id="chart_ui">
        </div>

    <div class="prediction-card" id="pred_ui">
        <h3>üìú ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§´‡§≤‡§æ‡§¶‡•á‡§∂ (Detailed Analysis):</h3>
        <div id="aspects_text"></div>
    </div>

    <table>
        <thead>
            <tr><th>‡§ó‡•ç‡§∞‡§π</th><th>‡§∞‡§æ‡§∂‡§ø</th><th>‡§Ö‡§Ç‡§∂ (Deg)</th><th>‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞</th><th>‡§ö‡§∞‡§£</th><th>‡§≠‡§æ‡§µ (House)</th></tr>
        </thead>
        <tbody id="planet_table"></tbody>
    </table>

<script>
    async function loadKundli() {
        const resp = await fetch(`https://hemantpurohit27.pythonanywhere.com/api/quantum_astro_v31?date=2006-11-06&time=11:28&lat=24.58&lng=73.71`);
        const data = await resp.json();

        // 1. Render Panchang
        const p = data.panchang;
        document.getElementById('panchang_ui').innerHTML = `
            <div class="pan-box"><b>‡§µ‡§æ‡§∞</b><br>${p.war}</div>
            <div class="pan-box"><b>‡§§‡§ø‡§•‡§ø</b><br>${p.tithi}</div>
            <div class="pan-box"><b>‡§™‡§ï‡•ç‡§∑</b><br>${p.paksha}</div>
            <div class="pan-box"><b>‡§Ø‡•ã‡§ó</b><br>${p.yoga}</div>
            <div class="pan-box"><b>‡§ï‡§∞‡§£</b><br>${p.karan}</div>
        `;

        // 2. Render D1 Chart (Logic fix for Ju, Ve, Ke)
        document.getElementById('chart_ui').innerHTML = drawNorthChart(data.asc, data.planets);

        // 3. Render Planet Table
        document.getElementById('planet_table').innerHTML = data.planets.map(pl => `
            <tr>
                <td>${pl.name}</td><td>${pl.sign}</td><td>${pl.deg}¬∞</td>
                <td>${pl.nak}</td><td>${pl.charan}</td><td>${pl.house}</td>
            </tr>
        `).join('');

        // 4. Render Predictions
        document.getElementById('aspects_text').innerHTML = data.aspects.map(a => `‚Ä¢ ${a}<br>`).join('');
    }

    function drawNorthChart(lagna, planets) {
        // Simplified North Indian Chart SVG logic
        const coords = {1:[150,100], 2:[75,50], 3:[50,75], 4:[100,150], 5:[50,225], 6:[75,250], 7:[150,200], 8:[225,250], 9:[250,225], 10:[200,150], 11:[250,75], 12:[225,50]};
        let svg = `<svg width="400" height="400" viewBox="0 0 300 300" style="border:2px solid #000">
            <path d="M0 0 L300 300 M300 0 L0 300 M150 0 L0 150 L150 300 L300 150 Z" stroke="black" fill="none"/>`;
        
        for(let i=1; i<=12; i++) {
            let r_num = ((lagna + i - 2) % 12) + 1;
            svg += `<text x="${coords[i][0]}" y="${coords[i][1]}" font-size="16" fill="red" font-weight="bold">${r_num}</text>`;
            
            // Filter planets for this house
            let p_in_house = planets.filter(p => p.house === i);
            p_in_house.forEach((p, idx) => {
                svg += `<text x="${coords[i][0]}" y="${coords[i][1] + 20 + (idx*15)}" font-size="12" fill="blue">${p.name.substring(0,2)}</text>`;
            });
        }
        return svg + `</svg>`;
    }

    window.onload = loadKundli;
</script>
</body>
</html>
