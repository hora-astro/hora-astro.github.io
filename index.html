<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>ASTRO-FINAL PRECISION V110</title>
    <style>
        .chart-box { width: 400px; height: 400px; margin: auto; border: 2px solid #8b0000; background: #fff; }
        .data-table { width: 100%; border-collapse: collapse; margin-top: 20px; color: black; }
        th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
        .report-container { width: 800px; margin: auto; padding: 20px; background: white; border: 5px double #8b0000; color: black;}
    </style>
</head>
<body style="background:#1a202c; color:white;">

<div style="text-align:center; padding:20px;">
    <button onclick="calculate()" style="padding:15px 30px; background:#b45309; color:white; border:none; border-radius:8px; cursor:pointer;">कुंडली जनरेट करें</button>
</div>

<div id="report" class="report-container" style="display:none;">
    <h1 align="center">॥ सटीक जन्म कुंडली ॥</h1>
    <div class="chart-box" id="d1-chart"></div>
    <table class="data-table" id="p-table"></table>
</div>

<script>
    async function calculate() {
        // 27-03-1980, 08:10 AM के लिए मेष लग्न फिक्स है
        const res = await fetch(`https://hemantpurohit27.pythonanywhere.com/api/v110_final?date=1980-03-27&time=08:10`);
        const data = await res.json();
        
        document.getElementById('report').style.display = 'block';
        
        // चार्ट रेंडरिंग
        drawChart("d1-chart", data.asc, data.planets);

        // टेबल अपडेट
        let html = `<tr style="background:#eee;"><th>ग्रह</th><th>राशि (Sign)</th><th>अंश (Degree)</th><th>भाव (House)</th></tr>`;
        data.planets.forEach(p => {
            html += `<tr><td>${p.name}</td><td>${p.sign}</td><td>${p.deg}°</td><td><b>${p.house}</b></td></tr>`;
        });
        document.getElementById('p-table').innerHTML = html;
    }

    function drawChart(container, asc, planets) {
        // भावों के सटीक केंद्र (Fixed House Points)
        const pos = {
            1: [200, 160], 2: [100, 80], 3: [50, 160], 4: [140, 250], 
            5: [50, 340], 6: [100, 380], 7: [200, 320], 8: [300, 380], 
            9: [350, 340], 10: [260, 250], 11: [350, 160], 12: [300, 80]
        };

        let svg = `<svg viewBox="0 0 400 400" width="100%" height="100%">
            <path d="M0 0 L400 400 M400 0 L0 400 M200 0 L0 200 L200 400 L400 200 Z" fill="none" stroke="red" stroke-width="2"/>`;

        for (let h = 1; h <= 12; h++) {
            // राशि नंबर (लाल)
            let r_num = ((asc + h - 2) % 12) + 1;
            svg += `<text x="${pos[h][0]}" y="${pos[h][1]}" fill="red" font-weight="bold" font-size="20" text-anchor="middle">${r_num}</text>`;

            // उस भाव (House) में स्थित ग्रह (नीला)
            // फिल्टर अब केवल 'house' प्रॉपर्टी पर चलेगा, जो गणितीय रूप से सही है
            let p_in_h = planets.filter(p => p.house === h).map(p => p.name).join(' ');
            if (p_in_h) {
                svg += `<text x="${pos[h][0]}" y="${pos[h][1]+30}" fill="blue" font-size="14" font-weight="bold" text-anchor="middle">${p_in_h}</text>`;
            }
        }
        document.getElementById(container).innerHTML = svg + `</svg>`;
    }
</script>
</body>
</html>
