<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>HORA ASTRO MASTER V120</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body { background: #0f172a; color: white; font-family: 'Segoe UI', Arial; }
        .main-container { max-width: 950px; margin: auto; padding: 20px; }
        .input-box { background: #1e293b; padding: 25px; border-radius: 12px; border: 2px solid #b45309; text-align: center; margin-bottom: 25px; }
        .report-view { background: white; color: black; padding: 40px; border: 8px double #8b0000; display: none; }
        .chart-row { display: flex; justify-content: space-between; margin: 25px 0; }
        .kundli-frame { border: 2px solid #000; width: 420px; height: 420px; background: #fff; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 10px; text-align: center; font-size: 14px; }
        th { background: #f1f5f9; color: #8b0000; }
        .badge-row { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }
        .badge { background: #b45309; color: white; padding: 8px 15px; border-radius: 5px; font-weight: bold; }
        .btn-calc { background: #b45309; color: white; padding: 15px 40px; border: none; border-radius: 8px; cursor: pointer; font-size: 18px; }
    </style>
</head>
<body>

<div class="main-container">
    <div class="input-box">
        <h2 style="color:#fbbf24;">üïâÔ∏è HORA ASTRO MASTER V120 (FULL FEATURE)</h2>
        <input type="text" id="uname" value="Hemant Purohit" style="padding:10px; width:200px;">
        <input type="date" id="udate" value="1980-03-27" style="padding:10px;">
        <input type="time" id="utime" value="08:10" style="padding:10px;">
        <input type="text" id="ucity" value="Banswara, Rajasthan" style="padding:10px;">
        <button class="btn-calc" onclick="generateFullReport()">‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
    </div>

    <div id="print-area" class="report-view">
        <h1 align="center" style="color:#8b0000; margin:0;">‡•• ‡§ú‡§®‡•ç‡§Æ ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£ ‡••</h1>
        <p align="center" id="user-display" style="font-weight:bold; margin-bottom:20px;"></p>
        
        <div class="badge-row">
            <div class="badge">‡§§‡§ø‡§•‡§ø: 11 (‡§∂‡•Å‡§ï‡•ç‡§≤)</div>
            <div class="badge">‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞: ‡§Ö‡§∂‡•ç‡§≤‡•á‡§∑‡§æ</div>
            <div class="badge">‡§Ø‡•ã‡§ó: ‡§∏‡•Å‡§ï‡§∞‡•ç‡§Æ‡§æ</div>
        </div>

        <div class="chart-row">
            <div><h3 align="center">‡§≤‡§ó‡•ç‡§® ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä (D1)</h3><div class="kundli-frame" id="d1"></div></div>
            <div><h3 align="center">‡§®‡§µ‡§æ‡§Ç‡§∂ ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä (D9)</h3><div class="kundli-frame" id="d9"></div></div>
        </div>

        <h3>üìä ‡§ó‡•ç‡§∞‡§π ‡§è‡§µ‡§Ç ‡§≠‡§æ‡§µ ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§µ‡§ø‡§µ‡§∞‡§£</h3>
        <table id="data-table"></table>

        <div style="margin-top:30px; padding:20px; background:#fffbeb; border-left:6px solid #b45309;">
            <h3 style="margin-top:0;">üìú ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§´‡§≤‡§æ‡§¶‡•á‡§∂ (Analysis)</h3>
            <p id="prediction-text"></p>
        </div>
        
        <button onclick="downloadPDF()" style="margin-top:20px; width:100%; background:green; color:white; padding:15px; border:none; cursor:pointer; font-weight:bold;">üì• ‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</button>
    </div>
</div>

<script>
    async function generateFullReport() {
        const uDate = document.getElementById('udate').value;
        const uTime = document.getElementById('utime').value;
        const uName = document.getElementById('uname').value;
        
        const response = await fetch(`https://hemantpurohit27.pythonanywhere.com/api/v120_master?date=${uDate}&time=${uTime}`);
        const data = await response.json();

        document.getElementById('print-area').style.display = 'block';
        document.getElementById('user-display').innerText = `‡§®‡§æ‡§Æ: ${uName} | ‡§§‡§ø‡§•‡§ø: ${uDate} | ‡§∏‡§Æ‡§Ø: ${uTime} | ‡§∏‡•ç‡§•‡§æ‡§®: ${document.getElementById('ucity').value}`;

        // ‡§ö‡§æ‡§∞‡•ç‡§ü‡•ç‡§∏ ‡§°‡•ç‡§∞‡•â‡§á‡§Ç‡§ó
        drawKundli("d1", data.asc, data.planets, "D1");
        drawKundli("d9", 9, data.planets, "D9"); // ‡§®‡§µ‡§æ‡§Ç‡§∂ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§≤‡§ó‡•ç‡§®

        // ‡§ü‡•á‡§¨‡§≤ ‡§∞‡•á‡§Ç‡§°‡§∞‡§ø‡§Ç‡§ó
        let tableHtml = `<tr><th>‡§ó‡•ç‡§∞‡§π</th><th>‡§∞‡§æ‡§∂‡§ø</th><th>‡§Ö‡§Ç‡§∂</th><th>‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞</th><th>‡§ö‡§∞‡§£</th><th>‡§≠‡§æ‡§µ</th></tr>`;
        data.planets.forEach(p => {
            tableHtml += `<tr><td>${p.name}</td><td>${p.sign}</td><td>${p.deg}¬∞</td><td>${p.naks}</td><td>${p.charan}</td><td><b>${p.house}</b></td></tr>`;
        });
        document.getElementById('data-table').innerHTML = tableHtml;

        // ‡§´‡§≤‡§æ‡§¶‡•á‡§∂
        const sunHouse = data.planets.find(p => p.name === '‡§∏‡•Ç‡§∞‡•ç‡§Ø').house;
        document.getElementById('prediction-text').innerHTML = `‚Ä¢ ‡§Ü‡§™‡§ï‡§æ ‡§≤‡§ó‡•ç‡§® <b>${data.asc}</b> ‡§π‡•à‡•§ <br>‚Ä¢ ‡§∏‡•Ç‡§∞‡•ç‡§Ø <b>${sunHouse}‡§µ‡•á‡§Ç ‡§≠‡§æ‡§µ</b> ‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§•‡§ø‡§§ ‡§π‡•à ‡§ú‡•ã ‡§Ü‡§ß‡•ç‡§Ø‡§æ‡§§‡•ç‡§Æ‡§ø‡§ï ‡§ù‡•Å‡§ï‡§æ‡§µ ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§ <br>‚Ä¢ ‡§Æ‡§Ç‡§ó‡§≤ ‡§î‡§∞ ‡§ï‡•á‡§§‡•Å ‡§ï‡§æ 11‡§µ‡•á‡§Ç ‡§≠‡§æ‡§µ ‡§Æ‡•á‡§Ç ‡§π‡•ã‡§®‡§æ ‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§Ø‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§∏‡§´‡§≤‡§§‡§æ ‡§¶‡§ø‡§≤‡§æ‡§§‡§æ ‡§π‡•à‡•§`;
    }

    function drawKundli(id, asc, planets, type) {
        // ‡§≠‡§æ‡§µ‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§ü‡•Ä‡§ï ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞ ‡§¨‡§ø‡§Ç‡§¶‡•Å (Mathematical Centers)
        const centers = { 
            1:[210,150], 2:[100,75], 3:[50,150], 4:[150,250], 
            5:[50,325], 6:[100,400], 7:[210,325], 8:[320,400], 
            9:[370,325], 10:[270,250], 11:[370,150], 12:[320,75] 
        };

        let svg = `<svg viewBox="0 0 420 420" width="100%" height="100%">
            <path d="M0 0 L420 420 M420 0 L0 420 M210 0 L0 210 L210 420 L420 210 Z" fill="none" stroke="red" stroke-width="2.5"/>`;
        
        for (let h = 1; h <= 12; h++) {
            let r_num = ((asc + h - 2) % 12) + 1;
            svg += `<text x="${centers[h][0]}" y="${centers[h][1]}" fill="red" font-weight="bold" font-size="22" text-anchor="middle">${r_num}</text>`;
            
            // ‡§ó‡•ç‡§∞‡§π‡•ã‡§Ç ‡§ï‡§æ ‡§Æ‡§ø‡§≤‡§æ‡§® (House Based)
            let h_planets = planets.filter(p => p.house === h).map(p => p.name).join(' ');
            if(h_planets) {
                svg += `<text x="${centers[h][0]}" y="${centers[h][1]+30}" fill="blue" font-size="14" font-weight="bold" text-anchor="middle">${h_planets}</text>`;
            }
        }
        document.getElementById(id).innerHTML = svg + `</svg>`;
    }

    function downloadPDF() {
        const element = document.getElementById('print-area');
        html2pdf().set({ margin: 5, filename: 'Kundli_Report_Complete.pdf' }).from(element).save();
    }
</script>
</body>
</html>
