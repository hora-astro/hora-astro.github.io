<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siddhanta Astro - No Server Required</title>
    <script src="https://cdn.jsdelivr.net/npm/swephjs@1.0.12/dist/sweph.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root { --maroon: #800000; --gold: #daa520; }
        body { font-family: 'Arial', sans-serif; background: #f4f4f4; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .input-group { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; background: #fff8f0; padding: 15px; border-radius: 5px; }
        input, button { padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { background: var(--maroon); color: white; cursor: pointer; border: none; font-weight: bold; }
        .chart-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .chart-box { border: 2px solid var(--maroon); padding: 10px; text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th { background: var(--maroon); color: white; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align:center; color: var(--maroon);">॥ श्री गणेशाय नमः ॥</h2>
    
    <div class="input-group">
        <input type="text" id="name" placeholder="नाम" value="हेमंत पुरोहित">
        <input type="date" id="dob" value="1980-03-27">
        <input type="time" id="tob" value="10:30">
        <input type="number" id="lat" placeholder="Latitude" value="23.32" step="0.01">
        <input type="number" id="lon" placeholder="Longitude" value="74.26" step="0.01">
        <button onclick="calculateKundli()">कुंडली बनाएँ</button>
    </div>

    <div id="resultArea" style="display:none;">
        <div id="printSection">
            <div style="text-align:center; border-bottom: 2px solid var(--maroon); padding-bottom: 10px;">
                <h1 id="out_name"></h1>
                <p id="out_details"></p>
            </div>

            <div class="chart-container">
                <div class="chart-box">
                    <h3>D1 लग्न कुंडली</h3>
                    <div id="d1_chart"></div>
                </div>
                <div class="chart-box">
                    <h3>D9 नवांश कुंडली</h3>
                    <div id="d9_chart"></div>
                </div>
            </div>

            <table id="planetTable">
                <thead>
                    <tr>
                        <th>ग्रह</th>
                        <th>राशि</th>
                        <th>अंश (Deg)</th>
                        <th>भाव</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <button onclick="downloadPDF()" style="margin-top:20px; background: green;">PDF डाउनलोड करें</button>
    </div>
</div>

<script>
// ग्रहों के हिंदी नाम
const planetNames = ["सूर्य", "चंद्र", "मंगल", "बुध", "गुरु", "शुक्र", "शनि", "राहु", "केतु"];

function calculateKundli() {
    document.getElementById('resultArea').style.display = 'block';
    const dob = document.getElementById('dob').value;
    const tob = document.getElementById('tob').value;
    const lat = parseFloat(document.getElementById('lat').value);
    const lon = parseFloat(document.getElementById('lon').value);

    // बेसिक गणना (Simplified for Logic)
    // क्योंकि ब्राउज़र में पूरी Ephemeris फाइलें लोड करना भारी होता है, 
    // यहाँ हम एक गणितीय 'Nirayana' लॉजिक का उपयोग कर रहे हैं।
    
    let year = new Date(dob).getFullYear();
    let ayanamsa = 23.5 + (year - 1950) * 0.013; // अनुमानित लाहिरी आयनांश

    // डमी गणना (उदाहरण के लिए - क्योंकि असली sweph.js को 10MB की फाइलें चाहिए होती हैं)
    // हम ग्रहों की स्थिति को भावों में रेंडर करने का लॉजिक दिखा रहे हैं
    const planets = [
        {name: "सूर्य", house: 1, deg: "10°"},
        {name: "चंद्र", house: 5, deg: "15°"},
        {name: "मंगल", house: 9, deg: "22°"},
        {name: "बुध", house: 1, deg: "05°"},
        {name: "गुरु", house: 2, deg: "11°"},
        {name: "शुक्र", house: 12, deg: "28°"},
        {name: "शनि", house: 6, deg: "14°"},
        {name: "राहु", house: 4, deg: "19°"},
        {name: "केतु", house: 10, deg: "19°"}
    ];

    let lagna = 1; // डिफ़ॉल्ट मेष लग्न
    renderTable(planets);
    drawChart('d1_chart', lagna, planets);
    drawChart('d9_chart', 5, planets); // डमी नवांश
}

function renderTable(planets) {
    const tbody = document.querySelector("#planetTable tbody");
    tbody.innerHTML = "";
    planets.forEach(p => {
        tbody.innerHTML += `<tr><td>${p.name}</td><td>-</td><td>${p.deg}</td><td>${p.house}</td></tr>`;
    });
}

function drawChart(containerId, asc, planets) {
    const pos = {
        1:[225,170], 2:[110,95], 3:[55,170], 4:[150,265], 5:[55,345], 6:[110,420], 
        7:[225,345], 8:[340,420], 9:[395,345], 10:[300,265], 11:[395,170], 12:[340,95]
    };
    let svg = `<svg viewBox="0 0 450 480" width="100%">
        <path d="M0 0 L450 0 L450 450 L0 450 Z M0 0 L450 450 M450 0 L0 450 M225 0 L0 225 L225 450 L450 225 Z" fill="none" stroke="#333" stroke-width="2"/>`;
    
    for (let i = 1; i <= 12; i++) {
        let sign = (asc + i - 1) > 12 ? (asc + i - 1) - 12 : (asc + i - 1);
        svg += `<text x="${pos[i][0]}" y="${pos[i][1]+5}" fill="red" font-weight="bold" font-size="20" text-anchor="middle">${sign}</text>`;
        
        let inHouse = planets.filter(p => p.house === i);
        inHouse.forEach((p, idx) => {
            svg += `<text x="${pos[i][0]}" y="${pos[i][1]-20-(idx*15)}" font-size="12" text-anchor="middle">${p.name}</text>`;
        });
    }
    document.getElementById(containerId).innerHTML = svg + `</svg>`;
}

async function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF('p', 'mm', 'a4');
    const canvas = await html2canvas(document.getElementById('printSection'));
    doc.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, 210, 297);
    doc.save("Kundli.pdf");
}
</script>

</body>
</html>
