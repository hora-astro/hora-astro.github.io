<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hora Astro | Professional Software</title>
    <style>
        :root { --gold: #f59e0b; --bg: #0f172a; --panel: #1e293b; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        .input-card { background: var(--panel); padding: 25px; border-radius: 15px; border: 1px solid #334155; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        input, button { padding: 12px; border-radius: 8px; border: 1px solid #475569; background: #0f172a; color: white; font-size: 14px; }
        button { background: var(--gold); color: black; font-weight: bold; border: none; cursor: pointer; transition: 0.3s; }
        button:hover { background: #d97706; }
        
        .result-area { display: none; margin-top: 30px; }
        .chart-box { background: white; padding: 20px; border-radius: 15px; color: black; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        svg { width: 100%; max-width: 450px; height: auto; }
        
        table { width: 100%; margin-top: 20px; border-collapse: collapse; background: var(--panel); color: white; }
        th, td { border: 1px solid #334155; padding: 12px; text-align: left; }
        th { background: #020617; color: var(--gold); }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align:center; color:var(--gold);">॥ HORA ASTRO PRO ॥</h1>
    
    <div class="input-card">
        <div class="grid">
            <div><label>जन्म तिथि</label><input type="date" id="dob" value="1980-03-27"></div>
            <div><label>समय</label><input type="time" id="tob" value="08:10"></div>
            <div><label>Latitude</label><input type="text" id="lat" value="23.5"></div>
            <div><label>Longitude</label><input type="text" id="lon" value="74.4"></div>
        </div>
        <button onclick="generateChart()">सटीक कुंडली जनरेट करें</button>
    </div>

    <div id="loader" style="display:none; text-align:center; color:var(--gold);">ग्रहों की गणना चालू है...</div>

    <div id="result" class="result-area">
        <div class="chart-box" id="kundli-container">
            <h3 style="color:#b91c1c; margin-top:0;">लग्न कुंडली (D1)</h3>
            </div>

        <h3 style="color:var(--gold); margin-top:30px;">ग्रहों की स्पष्ट स्थिति</h3>
        <table>
            <thead><tr><th>ग्रह</th><th>राशि</th><th>अंश</th><th>नक्षत्र</th></tr></thead>
            <tbody id="planet-data"></tbody>
        </table>
    </div>
</div>

<script>
async function generateChart() {
    const dob = document.getElementById('dob').value;
    const tob = document.getElementById('tob').value;
    const lat = document.getElementById('lat').value;
    const lon = document.getElementById('lon').value;

    document.getElementById('loader').style.display = "block";
    document.getElementById('result').style.display = "none";

    const apiKey = "e7b14b21femsh6ee1327b27e7508p108379jsnf36df2f55b20"; 

    // हम 'Planet Details' मंगाएंगे क्योंकि यह एंडपॉइंट फ्री प्लान में काम करता है
    try {
        const response = await fetch('https://vedic-jyotish.p.rapidapi.com/planet-details', {
            method: 'POST',
            headers: {
                'x-rapidapi-key': apiKey,
                'x-rapidapi-host': 'vedic-jyotish.p.rapidapi.com',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                "year": parseInt(dob.split('-')[0]),
                "month": parseInt(dob.split('-')[1]),
                "date": parseInt(dob.split('-')[2]),
                "hours": parseInt(tob.split(':')[0]),
                "minutes": parseInt(tob.split(':')[1]),
                "latitude": parseFloat(lat),
                "longitude": parseFloat(lon),
                "timezone": 5.5,
                "config": { "ayanamsha": "lahiri", "language": "hi" }
            })
        });

        const data = await response.json();
        if(data.status === "success") {
            renderUI(data.response);
        } else {
            alert("API Error: " + (data.message || "विवरण चेक करें"));
        }
    } catch (err) {
        alert("सर्वर एरर! इंटरनेट चेक करें।");
    } finally {
        document.getElementById('loader').style.display = "none";
    }
}

function renderUI(planets) {
    // 1. टेबल भरें
    let tableHtml = "";
    planets.forEach(p => {
        tableHtml += `<tr><td>${p.name}</td><td>${p.rashinumber}</td><td>${p.fullDegree.toFixed(2)}°</td><td>${p.nakshatra || '-'}</td></tr>`;
    });
    document.getElementById('planet-data').innerHTML = tableHtml;

    // 2. कुंडली ड्रा करें (North Indian Style)
    // लग्न (Ascendant) राशि ढूंढें
    const ascendant = planets.find(p => p.name === "Ascendant") || {rashinumber: 2};
    const startRashi = parseInt(ascendant.rashinumber);
    
    const coords = {1:[175,130], 2:[85,60], 3:[40,130], 4:[115,215], 5:[40,290], 6:[85,360], 7:[175,290], 8:[265,360], 9:[310,290], 10:[225,215], 11:[310,130], 12:[265,60]};
    
    let svg = `<svg viewBox="0 0 350 350"><path d="M0 0 L350 350 M350 0 L0 350 M175 0 L0 175 L175 350 L350 175 Z" fill="none" stroke="red" stroke-width="2"/>`;
    
    for (let i = 1; i <= 12; i++) {
        let rNum = ((startRashi + i - 2) % 12) + 1;
        svg += `<text x="${coords[i][0]}" y="${coords[i][1]}" font-weight="bold" font-size="14">${rNum}</text>`;
        
        let shift = 20;
        planets.filter(p => p.name !== "Ascendant" && parseInt(p.rashinumber) === rNum).forEach(p => {
            svg += `<text x="${coords[i][0]}" y="${coords[i][1]+shift}" fill="blue" font-size="11">${p.name.substring(0,2)}</text>`;
            shift += 15;
        });
    }
    
    document.getElementById('kundli-container').innerHTML = `<h3 style="color:#b91c1c; margin-top:0;">लग्न कुंडली (D1)</h3>` + svg + `</svg>`;
    document.getElementById('result').style.display = "block";
}
</script>
</body>
</html>
