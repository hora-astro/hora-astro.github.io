<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Kundli Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>

<body>

<div class="container">

<h3 class="mt-3 text-center fw-bold">Kundli Generator</h3>

<div class="card mt-2">
<div class="card-body">

<div class="row">

<div class="col-md-4">
<label>Date of Birth</label>
<input type="date" id="dob" class="form-control">
</div>

<div class="col-md-4">
<label>Time of Birth</label>
<input type="time" id="tob" class="form-control">
</div>

<div class="col-md-4">
<label>Birth Place</label>
<input type="text" id="place" class="form-control" placeholder="City / Village">
<small id="locInfo" class="text-muted"></small>
</div>

</div>

<button class="btn btn-primary mt-3" onclick="getKundli()">Get Kundli</button>

</div>
</div>


<!-- RESULT BLOCK -->
<div class="card mt-3" id="result" style="display:none;">
<div class="card-body">

<h4>Lagna: <span id="lagna"></span></h4>

<h5 class="mt-3">Planetary Positions</h5>

<table class="table table-bordered">
<thead class="table-light">
<tr>
<th>Planet</th>
<th>Rashi</th>
<th>Degree</th>
<th>House</th>
</tr>
</thead>

<tbody id="planetTable"></tbody>

</table>

</div>
</div>

</div>

<script>
let lat=null, lon=null;

document.getElementById("place").addEventListener("change", async ()=>{
 let city=document.getElementById("place").value;

 let res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${city}`);
 let data = await res.json();

 if(data.length){
  lat=data[0].lat;
  lon=data[0].lon;

  document.getElementById("locInfo").innerText =
  "Location found ✓ Lat: "+lat+" Lon: "+lon;
 } else {
  document.getElementById("locInfo").innerText="City not found ❌";
 }
});


async function getKundli(){

 if(!lat || !lon){
  alert("Please enter valid birthplace");
  return;
 }

 let dob=document.getElementById("dob").value;
 let tob=document.getElementById("tob").value;

 let res = await fetch("https://hemantpurohit27.pythonanywhere.com/api/kundli",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify({
   dob:dob,
   tob:tob,
   lat:lat,
   lon:lon,
   timezone:"Asia/Kolkata"
  })
 });

 let data = await res.json();

 document.getElementById("lagna").innerText=data.lagna;

 let tbody=document.getElementById("planetTable");
 tbody.innerHTML="";

 data.planets.forEach(p=>{
  tbody.innerHTML+=`
   <tr>
    <td>${p.planet}</td>
    <td>${p.sign}</td>
    <td>${p.degree}°</td>
    <td>${p.house}</td>
   </tr>`;
 });

 document.getElementById("result").style.display="block";
}
</script>

</body>
</html>
