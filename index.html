<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Professional Astro API Engine</title>
    <style>
        :root { --gold: #f59e0b; --bg: #0f172a; --panel: #1e293b; --red: #ef4444; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        .card { background: var(--panel); padding: 30px; border-radius: 15px; border: 1px solid #334155; max-width: 1100px; margin: auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px; }
        input, button { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #475569; background: #020617; color: white; font-size: 16px; }
        button { background: var(--gold); color: black; font-weight: bold; cursor: pointer; border: none; }
        
        .status { text-align: center; margin: 20px; font-weight: bold; color: var(--gold); display: none; }
        .result-section { display: none; margin-top: 30px; }
        
        .charts { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px; }
        .chart-box { background: white; padding: 20px; border-radius: 12px; color: black; text-align: center; }
        svg { width: 100%; height: auto; }

        table { width: 100%; margin-top: 30px; border-collapse: collapse; background: #020617; }
        th, td { border: 1px solid #334155; padding: 12px; text-align: left; }
        th { color: var(--gold); background: #1e293b; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="text-align:center; color:var(--gold);">॥ PROFESSIONAL VEDIC ASTRO ENGINE ॥</h2>
    <div class="grid">
        <div><label>तारीख</label><input type="date" id="dob" value="1980-03-27"></div>
        <div><label>समय</label><input type="time" id="tob" value="08:10"></div>
        <div><label>Lat</label><input type="text" id="lat" value="23.33"></div>
        <div><label>Lon</label><input type="text" id="lon" value="74.26"></div>
    </div>
    <button onclick="getLiveKundli()">लाइव गणना शुरू करें (API)</button>

    <div id="status" class="status">ग्रहों की स्थिति की गणना सर्वर पर हो रही है...</div>

    <div id="result" class="result-section">
        <div class="charts">
            <div id="d1-wrap" class="chart-box"></div>
            <div id="d9-wrap" class="chart-box"></div>
        </div>
        <table>
            <thead>
                <tr><th>ग्रह</th><th>राशि</th><th>अंश (Nirayana)</th><th>नक्षत्र</th><th>स्वामी</th></tr>
            </thead>
            <tbody id="planet-table"></tbody>
        </table>
    </div>
</div>

<script>
async function getLiveKundli() {
    const dob = document.getElementById('dob').value;
    const tob = document.getElementById('tob').value;
    const lat = document.getElementById('lat').value;
    const lon = document.getElementById('lon').value;

    const [year, month, day] = dob.split('-');
    const [hour, min] = tob.split(':');

    const status = document.getElementById('status');
    const result = document.getElementById('result');
    
    status.style.display = 'block';
    result.style.display = 'none';

    // API Key - Replace with your RapidAPI Key
    const apiKey = 'YOUR_RAPIDAPI_KEY'; 

    const options = {
        method: 'POST',
        headers: {
            'e7b14b21femsh6ee1327b27e7508p108379jsnf36df2f55b20': apiKey,
            'x-rapidapi-host': 'vedic-jyotish.p.rapidapi.com',
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            day: parseInt(day), month: parseInt(month), year: parseInt(year),
            hour: parseInt(hour), min: parseInt(min), lat: parseFloat(lat), lon: parseFloat(lon), tzone: 5.5
        })
    };

    try {
        // 1. Fetching Planetary Positions
        const planetRes = await fetch('https://vedic-jyotish.p.rapidapi.com/planets/nirayana', options);
        const planets = await planetRes.json();

        // 2. Fetching D1 Chart Data
        const d1Res = await fetch('https://vedic-jyotish.p.rapidapi.com/horo_chart_draw/d1', options);
        const d1Data = await d1Res.json();

        // 3. Fetching D9 Chart Data
        const d9Res = await fetch('https://vedic-jyotish.p.rapidapi.com/horo_chart_draw/d9', options);
        const d9Data = await d9Res.json();

        renderPlanetTable(planets);
        document.getElementById('d1-wrap').innerHTML = `<h3>लग्न कुंडली (D1)</h3>` + d1Data.svg;
        document.getElementById('d9-wrap').innerHTML = `<h3>नवमांश कुंडली (D9)</h3>` + d9Data.svg;

        status.style.display = 'none';
        result.style.display = 'block';
    } catch (err) {
        alert("API Error: कृपया अपनी Key चेक करें");
        status.style.display = 'none';
    }
}

function renderPlanetTable(planets) {
    const html = planets.map(p => `
        <tr>
            <td>${p.name}</td>
            <td>${p.rashi} (${p.rashi_id})</td>
            <td>${p.full_degree.toFixed(2)}°</td>
            <td>${p.nakshatra}</td>
            <td>${p.nakshatra_lord}</td>
        </tr>
    `).join('');
    document.getElementById('planet-table').innerHTML = html;
}
</script>
</body>
</html>
