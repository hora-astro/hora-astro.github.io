<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Astro Prediction</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>

<body>

<div class="container">

<h3 class="mt-3 text-center">Kundli Generator</h3>

<div class="card">
<div class="card-body">

<div class="row">

<div class="col-md-4">
<label>Date of Birth</label>
<input type="date" id="dob" class="form-control">
</div>

<div class="col-md-4">
<label>Time of Birth</label>
<input type="time" id="tob" class="form-control">
</div>

<div class="col-md-4">
<label>Birth Place</label>
<input type="text" id="place" class="form-control" placeholder="City / Village">
<small id="locInfo" class="text-muted"></small>
</div>

</div>

<button class="btn btn-primary mt-3" onclick="getKundli()">Get Kundli</button>

</div>
</div>

<div class="card mt-2" id="result" style="display:none;">
<div class="card-body">
<h5>Lagna: <span id="lagna"></span></h5>
<p>D1: <span id="d1"></span></p>
<p>D9: <span id="d9"></span></p>
<p>Panchang: <span id="panchang"></span></p>
<p>Dasha: <span id="dasha"></span></p>
</div>
</div>

</div>

<script>
let lat = null;
let lon = null;

document.getElementById("place").addEventListener("change", async ()=>{

 let city = document.getElementById("place").value;

 let res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${city}`);

 let data = await res.json();

 if(data.length){
    lat = data[0].lat;
    lon = data[0].lon;

    document.getElementById("locInfo").innerText =
      "Location found ✓  Lat: "+lat+"  Lon: "+lon;
 } else {
    document.getElementById("locInfo").innerText = "City not found ❌";
 }
});


async function getKundli(){

 if(!lat || !lon){
   alert("Please enter valid birth place");
   return;
 }

 let dob = document.getElementById("dob").value;
 let tob = document.getElementById("tob").value;

 let res = await fetch("https://hemantpurohit27.pythonanywhere.com/api/kundli",{
   method:"POST",
   headers:{ "Content-Type":"application/json" },
   body:JSON.stringify({
     dob:dob,
     tob:tob,
     lat:lat,
     lon:lon,
     timezone:"Asia/Kolkata"
   })
 });

 let data = await res.json();

 document.getElementById("lagna").innerText = data.lagna;
 document.getElementById("d1").innerText = data.d1;
 document.getElementById("d9").innerText = data.d9;
 document.getElementById("panchang").innerText = data.panchang;
 document.getElementById("dasha").innerText = data.dasha;

 document.getElementById("result").style.display="block";
}
</script>

</body>
</html>
