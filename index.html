<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hora Astro Pro - Full Suite</title>
    <style>
        :root { --primary: #d35400; --bg: #2c1a0a; --card: #3d2b1f; --text: #fdf2e9; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; text-align: center; }
        .container { max-width: 500px; margin: auto; }
        
        /* Input Section */
        .card { background: var(--card); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #5d4037; }
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: none; background: #5d4037; color: white; box-sizing: border-box; }
        
        /* City Search List */
        #cityList { position: absolute; width: 100%; background: #5d4037; border-radius: 8px; z-index: 100; display: none; text-align: left; }
        .city-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #795548; }

        /* Grid Options (Image Style) */
        .option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .opt-box { background: var(--card); padding: 15px; border-radius: 12px; cursor: pointer; border: 1px solid #5d4037; transition: 0.3s; }
        .opt-box:hover { background: #5d4037; transform: translateY(-3px); }
        .opt-icon { font-size: 24px; margin-bottom: 8px; display: block; }
        .opt-title { font-weight: bold; font-size: 14px; color: #ffab91; }

        /* Chart SVG */
        .chart-svg { width: 100%; max-width: 350px; background: white; border: 2px solid #000; margin-top: 20px; border-radius: 5px; }
        .p-text { font-size: 10px; font-weight: bold; fill: #2c3e50; }
        .r-text { font-size: 16px; font-weight: bold; fill: #e74c3c; }

        .btn-main { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 16px; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="color: var(--primary);">‡§π‡§ø‡§®‡•ç‡§¶‡•Ç ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞ / ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä üåå</h2>
    
    <div class="card">
        <div style="display: flex; gap: 5px;">
            <input type="date" id="date" value="2006-11-06">
            <input type="time" id="time" value="11:28">
        </div>
        <div style="position: relative;">
            <input type="text" id="citySearch" placeholder="‡§∂‡§π‡§∞ ‡§ñ‡•ã‡§ú‡•á‡§Ç (‡§ú‡•à‡§∏‡•á: Banswara)" oninput="searchCity(this.value)">
            <div id="cityList"></div>
        </div>
        <input type="hidden" id="lat" value="23.49">
        <input type="hidden" id="lng" value="74.35">
        <button class="btn-main" style="margin-top: 10px;" onclick="calculate()">‡§°‡§æ‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</button>
    </div>

    <div id="display-area">
        </div>

    <div class="option-grid">
        <div class="opt-box" onclick="showChart()">
            <span class="opt-icon">‚ò∏Ô∏è</span>
            <span class="opt-title">‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä</span>
            <small style="display:block; font-size:10px; color:#ccc;">‡§ó‡•ç‡§∞‡§π ‡§∏‡•ç‡§•‡§ø‡§§‡§ø, ‡§≤‡§ó‡•ç‡§®</small>
        </div>
        <div class="opt-box" onclick="showPanchang()">
            <span class="opt-icon">üìÖ</span>
            <span class="opt-title">‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó</span>
            <small style="display:block; font-size:10px; color:#ccc;">‡§¶‡•à‡§®‡§ø‡§ï ‡§∂‡•Å‡§≠ ‡§∏‡§Æ‡§Ø</small>
        </div>
        <div class="opt-box" onclick="alert('‡§ú‡§≤‡•ç‡§¶ ‡§Ü ‡§∞‡§π‡§æ ‡§π‡•à!')">
            <span class="opt-icon">üë´</span>
            <span class="opt-title">‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§Æ‡§ø‡§≤‡§æ‡§®</span>
            <small style="display:block; font-size:10px; color:#ccc;">‡§ó‡•Å‡§£ ‡§Æ‡§ø‡§≤‡§æ‡§®, ‡§Ö‡§∑‡•ç‡§ü ‡§ï‡•Ç‡§ü</small>
        </div>
        <div class="opt-box" onclick="alert('‡§ú‡§≤‡•ç‡§¶ ‡§Ü ‡§∞‡§π‡§æ ‡§π‡•à!')">
            <span class="opt-icon">üóìÔ∏è</span>
            <span class="opt-title">‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞</span>
            <small style="display:block; font-size:10px; color:#ccc;">‡§§‡•ç‡§Ø‡•å‡§π‡§æ‡§∞ ‡§î‡§∞ ‡§µ‡•ç‡§∞‡§§</small>
        </div>
    </div>
</div>

<script>
    async function searchCity(q) {
        if(q.length < 3) return;
        const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${q}`);
        const data = await res.json();
        let list = document.getElementById('cityList');
        list.innerHTML = ''; list.style.display = 'block';
        data.slice(0, 5).forEach(item => {
            let div = document.createElement('div');
            div.className = 'city-item';
            div.innerText = item.display_name;
            div.onclick = () => {
                document.getElementById('citySearch').value = item.display_name.split(',')[0];
                document.getElementById('lat').value = item.lat;
                document.getElementById('lng').value = item.lon;
                list.style.display = 'none';
            };
            list.appendChild(div);
        });
    }

    async function calculate() {
        const url = `https://hemantpurohit27.pythonanywhere.com/get_kundli?date=${document.getElementById('date').value}&time=${document.getElementById('time').value}&lat=${document.getElementById('lat').value}&lng=${document.getElementById('lng').value}`;
        const res = await fetch(url);
        window.astroData = await res.json();
        if(window.astroData.status === "success") showChart();
    }

    function showChart() {
        const area = document.getElementById('display-area');
        if(!window.astroData) { area.innerHTML = "‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§≤‡•á ‡§°‡§æ‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç‡•§"; return; }
        area.innerHTML = `<h3>‡§≤‡§ó‡•ç‡§® ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä (D1)</h3>` + drawSVG(window.astroData.d1.lagna, window.astroData.d1.planets);
    }

    function showPanchang() {
        const area = document.getElementById('display-area');
        if(!window.astroData) return;
        const p = window.astroData.panchang;
        area.innerHTML = `<div class="card" style="text-align:left;">
            <p><b>üìÖ ‡§µ‡§æ‡§∞:</b> ${p.day}</p>
            <p><b>üåô ‡§§‡§ø‡§•‡§ø:</b> ${p.tithi}</p>
            <p><b>‚ú® ‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞:</b> ${p.nakshatra}</p>
            <p><b>üí† ‡§Ø‡•ã‡§ó:</b> ${p.yog}</p>
        </div>`;
    }

    function drawSVG(lagna, planets) {
        const coords = { 1:[150,90], 2:[80,45], 3:[45,80], 4:[95,150], 5:[45,220], 6:[80,255], 7:[150,210], 8:[220,255], 9:[255,220], 10:[205,150], 11:[255,80], 12:[220,45] };
        let svg = `<svg viewBox="0 0 300 300" class="chart-svg">
            <line x1="0" y1="0" x2="300" y2="300" stroke="#000"/><line x1="300" y1="0" x2="0" y2="300" stroke="#000"/>
            <line x1="150" y1="0" x2="0" y2="150" stroke="#000"/><line x1="0" y1="150" x2="150" y2="300" stroke="#000"/>
            <line x1="150" y1="300" x2="300" y2="150" stroke="#000"/><line x1="300" y1="150" x2="150" y2="0" stroke="#000"/>`;

        for (let i = 1; i <= 12; i++) {
            let rashi = ((lagna + i - 2) % 12) + 1;
            svg += `<text x="${coords[i][0]}" y="${coords[i][1]}" class="r-text" text-anchor="middle">${rashi}</text>`;
        }
        
        let counts = {};
        planets.forEach(p => {
            counts[p.house] = (counts[p.house] || 0) + 1;
            // ‡§Ø‡§π‡§æ‡§Å ‡§ó‡•ç‡§∞‡§π‡•ã‡§Ç ‡§ï‡•ã ‡§è‡§ï-‡§¶‡•Ç‡§∏‡§∞‡•á ‡§ï‡•á ‡§ä‡§™‡§∞ ‡§Ü‡§®‡•á ‡§∏‡•á ‡§∞‡•ã‡§ï‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à (Stacked positioning)
            let yOff = coords[p.house][1] + (counts[p.house] * 13);
            svg += `<text x="${coords[p.house][0]}" y="${yOff}" class="p-text" text-anchor="middle">${p.name} ${p.degree}¬∞</text>`;
        });
        return svg + "</svg>";
    }
</script>
</body>
</html>
