<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>HORA ASTRO COMPLETE V67.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { --main-gold: #b45309; }
        body { background: #0f172a; color: white; font-family: 'Arial'; padding: 20px; }
        .input-panel { background: #1e293b; padding: 20px; border-radius: 10px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; border: 1px solid var(--main-gold); }
        .report-card { background: white; color: black; padding: 25px; width: 800px; margin: 20px auto; border: 10px double var(--main-gold); display: none; }
        .pan-strip { display: flex; justify-content: space-around; background: #fffbeb; padding: 10px; border: 1px solid #ddd; margin-bottom: 20px; font-weight: bold; }
        .charts { display: flex; gap: 20px; justify-content: center; }
        .svg-container { border: 2px solid #000; width: 360px; height: 360px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
        .btn-pdf { background: green; color: white; padding: 15px; width: 800px; display: none; margin: 10px auto; cursor: pointer; border-radius: 8px; border: none; font-size: 16px; font-weight: bold; }
    </style>
</head>
<body>

<div class="input-panel">
    <input type="text" id="name" placeholder="‡§ú‡§æ‡§§‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ" value="Hemant Purohit">
    <input type="date" id="date" value="2006-11-06">
    <input type="time" id="time" value="11:28">
    <input type="text" id="city" placeholder="‡§∂‡§π‡§∞ (‡§â‡§¶‡§æ. Banswara)" value="Banswara">
    <button onclick="fetchAstro()" style="background:var(--main-gold); border:none; cursor:pointer; font-weight:bold;">‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§¨‡§®‡§æ‡§è‡§Å</button>
</div>

<div id="capture-area" class="report-card">
    <h2 align="center" style="color:var(--main-gold);">‡•• ‡§∂‡•ç‡§∞‡•Ä ‡§ó‡§£‡•á‡§∂‡§æ‡§Ø ‡§®‡§Æ‡§É ‡••</h2>
    <div class="pan-strip" id="pan-ui"></div>

    <div class="charts">
        <div class="svg-container" id="d1-box"></div>
        <div class="svg-container" id="d9-box"></div>
    </div>

    <table id="p-table"></table>
    <div id="prediction" style="margin-top:20px; padding:15px; background:#f0f9ff; border-left:5px solid #0369a1;">
        <b>‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§´‡§≤‡§æ‡§¶‡•á‡§∂:</b> ‡§Ü‡§™‡§ï‡•á ‡§≤‡§ó‡•ç‡§®‡•á‡§∂ ‡§ó‡•Å‡§∞‡•Å 12‡§µ‡•á‡§Ç ‡§≠‡§æ‡§µ ‡§Æ‡•á‡§Ç ‡§π‡•à‡§Ç ‡§ú‡•ã ‡§Ü‡§ß‡•ç‡§Ø‡§æ‡§§‡•ç‡§Æ‡§ø‡§ï ‡§â‡§®‡•ç‡§®‡§§‡§ø ‡§î‡§∞ ‡§µ‡§ø‡§¶‡•á‡§∂ ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡•á ‡§Ø‡•ã‡§ó ‡§¨‡§®‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§∂‡•Å‡§ï‡•ç‡§∞ ‡§ï‡§æ 11‡§µ‡•á‡§Ç ‡§≠‡§æ‡§µ ‡§Æ‡•á‡§Ç ‡§π‡•ã‡§®‡§æ ‡§µ‡•à‡§≠‡§µ ‡§î‡§∞ ‡§ê‡§∂‡•ç‡§µ‡§∞‡•ç‡§Ø ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§
    </div>
</div>

<button id="pdf-btn" class="btn-pdf" onclick="generatePDF()">üì• ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</button>

<script>
    async function fetchAstro() {
        // ‡§Ü‡§™‡§ï‡§æ ‡§∏‡§ü‡•Ä‡§ï PythonAnywhere URL
        const url = `https://hemantpurohit27.pythonanywhere.com/api/v67_final?name=${document.getElementById('name').value}&date=${document.getElementById('date').value}&time=${document.getElementById('time').value}&lat=24.58&lng=73.71`;
        
        const res = await fetch(url);
        const data = await res.json();

        document.getElementById('capture-area').style.display = 'block';
        document.getElementById('pdf-btn').style.display = 'block';

        // ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó
        document.getElementById('pan-ui').innerHTML = `<span>‡§Æ‡§æ‡§π: ${data.panchang.month}</span> | <span>‡§™‡§ï‡•ç‡§∑: ${data.panchang.paksha}</span> | <span>‡§§‡§ø‡§•‡§ø: ${data.panchang.tithi}</span> | <span>‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞: ${data.panchang.nak}</span>`;

        // ‡§ö‡§æ‡§∞‡•ç‡§ü‡•ç‡§∏ ‡§°‡•ç‡§∞‡§æ‡§á‡§Ç‡§ó (Correct Placement)
        drawChart("d1-box", data.asc, data.planets, "‡§≤‡§ó‡•ç‡§® ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä (D1)");
        drawChart("d9-box", 8, data.planets, "‡§®‡§µ‡§æ‡§Ç‡§∂ ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä (D9)");

        // ‡§ü‡•á‡§¨‡§≤
        let html = `<tr><th>‡§ó‡•ç‡§∞‡§π</th><th>‡§Ö‡§Ç‡§∂</th><th>‡§≠‡§æ‡§µ</th></tr>`;
        data.planets.forEach(p => html += `<tr><td>${p.name}</td><td>${p.deg}¬∞</td><td>${p.house}</td></tr>`);
        document.getElementById('p-table').innerHTML = html;
    }

    function drawChart(containerId, asc, planets, title) {
        // ‡§∏‡•ç‡§•‡§ø‡§∞ ‡§≠‡§æ‡§µ‡•ã‡§Ç ‡§ï‡•á ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞ ‡§¨‡§ø‡§Ç‡§¶‡•Å (House coordinates)
        const pos = {1:[180,140], 2:[90,70], 3:[50,140], 4:[130,220], 5:[50,300], 6:[90,360], 7:[180,300], 8:[270,360], 9:[350,300], 10:[230,220], 11:[350,140], 12:[270,70]};
        
        let svg = `<svg viewBox="0 0 400 400" style="width:100%; height:100%"><text x="200" y="25" text-anchor="middle" font-weight="bold">${title}</text>
            <path d="M0 40 L400 400 M400 40 L0 400 M200 40 L0 220 L200 400 L400 220 Z" fill="none" stroke="black" stroke-width="2"/>`;
        
        for(let i=1; i<=12; i++) {
            let rashi = ((asc + i - 2) % 12) + 1;
            svg += `<text x="${pos[i][0]}" y="${pos[i][1]}" fill="red" font-weight="bold" font-size="16">${rashi}</text>`;
            
            // ‡§ó‡•ç‡§∞‡§π‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§π‡•Ä ‡§™‡•ç‡§≤‡•á‡§∏‡§Æ‡•á‡§Ç‡§ü (Filtering by House)
            let pList = planets.filter(p => p.house === i).map(p => p.name).join(' ');
            svg += `<text x="${pos[i][0]}" y="${pos[i][1]+25}" fill="blue" font-size="12" font-weight="bold" text-anchor="middle">${pList}</text>`;
        }
        document.getElementById(containerId).innerHTML = svg + `</svg>`;
    }

    function generatePDF() {
        const element = document.getElementById('capture-area');
        const opt = {
            margin: 5,
            filename: 'Astro_Kundli_Professional.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        html2pdf().set(opt).from(element).save();
    }
</script>
</body>
</html>
