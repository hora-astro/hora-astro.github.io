<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astro-Omni Quantum Engine V30.1</title>
    <style>
        :root { --gold: #f1c40f; --bg: #0c1117; --text: #e6edf3; --panel: #161b22; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', Arial, sans-serif; padding: 20px; margin: 0; }
        .master-container { max-width: 1200px; margin: auto; }
        
        /* Input Panel */
        .glass-panel { background: var(--panel); padding: 25px; border-radius: 15px; border: 1px solid #30363d; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.5); }
        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; }
        input, button { padding: 12px; border-radius: 8px; border: 1px solid #30363d; background: #0d1117; color: white; font-size: 14px; }
        button { background: var(--gold); color: black; font-weight: bold; cursor: pointer; border: none; transition: 0.3s; }
        button:hover { background: #d4ac0d; transform: translateY(-2px); }

        /* Panchang Grid */
        .panchang-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .pan_item { background: #1f2937; padding: 15px; border-radius: 10px; border-top: 4px solid var(--gold); text-align: center; font-weight: bold; }
        
        /* Charts */
        .chart-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 25px; }
        .chart-box { background: white; padding: 20px; border-radius: 15px; color: black; text-align: center; }
        .chart-box h3 { margin-top: 0; color: #1a1a1a; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        svg { width: 100%; max-width: 400px; height: auto; }

        /* Table & Predictions */
        .table-container { overflow-x: auto; margin-top: 30px; }
        table { width: 100%; border-collapse: collapse; background: var(--panel); border-radius: 10px; overflow: hidden; }
        th, td { padding: 15px; border: 1px solid #30363d; text-align: left; }
        th { background: #21262d; color: var(--gold); text-transform: uppercase; font-size: 13px; }
        .aspect-box { background: #1c2128; border-left: 5px solid #2ecc71; padding: 20px; margin-top: 25px; border-radius: 8px; line-height: 1.6; }
    </style>
</head>
<body>

    <div class="master-container">
        <h1 align="center" style="color:var(--gold); margin-bottom: 30px;">üïâÔ∏è ASTRO-OMNI QUANTUM V30.1</h1>

        <div class="glass-panel">
            <div class="input-grid">
                <input type="text" id="name" placeholder="‡§®‡§æ‡§Æ" value="‡§π‡•á‡§Æ‡§Ç‡§§ ‡§™‡•Å‡§∞‡•ã‡§π‡§ø‡§§">
                <input type="date" id="date" value="2006-11-06">
                <input type="time" id="time" value="11:28">
                <input type="text" id="lat" placeholder="‡§Ö‡§ï‡•ç‡§∑‡§æ‡§Ç‡§∂ (Lat)" value="24.58">
                <input type="text" id="lng" placeholder="‡§¶‡•á‡§∂‡§æ‡§Ç‡§§‡§∞ (Lng)" value="73.71">
            </div>
            <button onclick="calculate()" style="width:100%; margin-top:15px;">‡§™‡•Ç‡§∞‡•ç‡§£ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§î‡§∞ ‡§∏‡§ü‡•Ä‡§ï ‡§ó‡§£‡§®‡§æ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
        </div>

        <div id="results" style="display:none">
            <div class="panchang-grid" id="pan_grid"></div>

            <div class="chart-row">
                <div class="chart-box">
                    <h3>‡§≤‡§ó‡•ç‡§® ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä (D1)</h3>
                    <div id="d1_svg"></div>
                </div>
                <div class="chart-box">
                    <h3>‡§®‡§µ‡§æ‡§Ç‡§∂ ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä (D9)</h3>
                    <div id="d9_svg"></div>
                </div>
            </div>

            <div class="aspect-box" id="aspect_list"></div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>‡§ó‡•ç‡§∞‡§π</th>
                            <th>‡§∞‡§æ‡§∂‡§ø</th>
                            <th>‡§Ö‡§Ç‡§∂ (Deg)</th>
                            <th>‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞</th>
                            <th>‡§ö‡§∞‡§£</th>
                            <th>‡§≠‡§æ‡§µ</th>
                        </tr>
                    </thead>
                    <tbody id="p_body"></tbody>
                </table>
            </div>
        </div>
    </div>

<script>
    async function calculate() {
        const url = `/api/quantum_astro_v30?name=${document.getElementById('name').value}&date=${document.getElementById('date').value}&time=${document.getElementById('time').value}&lat=${document.getElementById('lat').value}&lng=${document.getElementById('lng').value}`;
        
        try {
            const r = await fetch(url);
            const d = await r.json();

            if(d.error) { alert("Error: " + d.error); return; }

            document.getElementById('results').style.display = 'block';
            
            // 1. ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó ‡§Ö‡§™‡§°‡•á‡§ü (Added War, Tithi, Nak, Yoga, Karan)
            document.getElementById('pan_grid').innerHTML = `
                <div class="pan_item">üìÖ ‡§µ‡§æ‡§∞: ${d.panchang.war}</div>
                <div class="pan_item">üåô ‡§§‡§ø‡§•‡§ø: ${d.panchang.tithi}</div>
                <div class="pan_item">‚ú® ‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞: ${d.panchang.nak}</div>
                <div class="pan_item">üåÄ ‡§Ø‡•ã‡§ó: ${d.panchang.yoga}</div>
            `;

            // 2. ‡§ö‡§æ‡§∞‡•ç‡§ü‡•ç‡§∏ ‡§∞‡•á‡§Ç‡§°‡§∞‡§ø‡§Ç‡§ó
            document.getElementById('d1_svg').innerHTML = drawNorthChart(d.asc, d.planets, 'd1');
            document.getElementById('d9_svg').innerHTML = drawNorthChart(d.d9_asc, d.planets, 'd9');

            // 3. ‡§ó‡•ç‡§∞‡§π ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§§‡§æ‡§≤‡§ø‡§ï‡§æ (Degrees, Nakshatra Charan, House)
            document.getElementById('p_body').innerHTML = d.planets.map(p => `
                <tr>
                    <td style="font-weight:bold; color:var(--gold)">${p.name}</td>
                    <td>${p.sign}</td>
                    <td>${p.deg}¬∞</td>
                    <td>${p.nak || '-'}</td>
                    <td>${p.charan || '-'}</td>
                    <td style="color:#2ecc71; font-weight:bold;">${p.house}</td>
                </tr>
            `).join('');

            // 4. ‡§¶‡•É‡§∑‡•ç‡§ü‡§ø ‡§î‡§∞ ‡§´‡§≤‡§æ‡§¶‡•á‡§∂
            document.getElementById('aspect_list').innerHTML = `
                <h3 style="color:var(--gold); margin-top:0;">üìú ‡§¶‡•É‡§∑‡•ç‡§ü‡§ø ‡§∏‡§Ç‡§¨‡§Ç‡§ß ‡§î‡§∞ ‡§´‡§≤‡§æ‡§¶‡•á‡§∂:</h3>
                <div style="color:#e6edf3;">
                    ${d.aspects.map(a => `‚Ä¢ ${a}`).join('<br>')}
                </div>
            `;

        } catch (err) {
            console.error(err);
            alert("‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§∏‡•á ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§¨‡•à‡§ï‡§è‡§Ç‡§° ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à‡•§");
        }
    }

    function drawNorthChart(lagna, planets, mode) {
        const h = {
            1:[150,85], 2:[75,40], 3:[40,75], 4:[100,150], 5:[40,225], 
            6:[75,260], 7:[150,215], 8:[225,260], 9:[260,225], 10:[200,150], 
            11:[260,75], 12:[225,40]
        };
        
        let svg = `<svg viewBox="0 0 300 300">
            <path d="M0 0 L300 300 M300 0 L0 300 M150 0 L0 150 L150 300 L300 150 Z" stroke="#333" fill="none" stroke-width="2"/>
            <rect width="300" height="300" fill="none" stroke="black" stroke-width="3"/>`;
        
        // ‡§∞‡§æ‡§∂‡§ø ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§∞‡•á‡§Ç‡§°‡§∞‡§ø‡§Ç‡§ó (Red Color)
        for(let i=1; i<=12; i++) {
            let r = ((lagna + i - 2) % 12) + 1;
            svg += `<text x="${h[i][0]}" y="${h[i][1]}" fill="#e74c3c" font-weight="bold" font-size="18" text-anchor="middle">${r}</text>`;
        }

        // ‡§ó‡•ç‡§∞‡§π‡•ã‡§Ç ‡§ï‡§æ ‡§™‡•ç‡§≤‡•á‡§∏‡§Æ‡•á‡§Ç‡§ü (Blue Color)
        let tracker = {};
        planets.forEach(p => {
            let p_sign = (mode === 'd1') ? p.sign : p.d9;
            let house = ((p_sign - lagna + 12) % 12) + 1;
            if(!tracker[house]) tracker[house] = 0;
            
            // ‡§ì‡§µ‡§∞‡§≤‡•à‡§™‡§ø‡§Ç‡§ó ‡§∏‡•á ‡§¨‡§ö‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è Y-‡§Ö‡§ï‡•ç‡§∑ ‡§™‡§∞ ‡§∂‡§ø‡§´‡•ç‡§ü
            let yOffset = h[house][1] + 20 + (tracker[house] * 15);
            svg += `<text x="${h[house][0]}" y="${yOffset}" fill="#2980b9" font-weight="bold" font-size="12" text-anchor="middle">${p.name.substring(0,2)}</text>`;
            tracker[house]++;
        });
        
        return svg + "</svg>";
    }
</script>
</body>
</html>
