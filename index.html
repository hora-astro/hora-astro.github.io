<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Hora Astro Pro</title>
    <style>
        :root { --bg: #1e1208; --card: #2d1d12; --main: #d35400; --text: #fdf2e9; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; padding: 10px; }
        .card { background: var(--card); padding: 15px; border-radius: 12px; border: 1px solid #4e342e; margin-bottom: 15px; }
        input { width: 100%; padding: 12px; margin: 5px 0; border-radius: 8px; background: #3d2b1f; color: white; border: none; }
        .btn { width: 100%; padding: 15px; background: var(--main); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        
        /* Location Dropdown */
        #cityList { background: #3d2b1f; border-radius: 5px; position: absolute; width: 90%; z-index: 10; display: none; }
        .city-opt { padding: 10px; border-bottom: 1px solid #4e342e; cursor: pointer; }

        .panchang-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .pan-item { background: #3d2b1f; padding: 10px; border-radius: 8px; border-left: 3px solid var(--main); }
        .chart-svg { width: 100%; background: white; border-radius: 8px; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="color:var(--main)">Hora Astro Pro üåå</h2>
    <input type="text" id="cityName" placeholder="‡§∂‡§π‡§∞ ‡§ñ‡•ã‡§ú‡•á‡§Ç (‡§ú‡•à‡§∏‡•á: Banswara)" oninput="searchCity(this.value)">
    <div id="cityList"></div>
    <div style="display:flex; gap:5px;">
        <input type="date" id="date" value="2006-11-06">
        <input type="time" id="time" value="11:28">
    </div>
    <input type="hidden" id="lat"><input type="hidden" id="lng">
    <button class="btn" onclick="fetchAstro()">‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§î‡§∞ ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</button>
</div>

<div id="result-area"></div>

<script>
    async function searchCity(q) {
        if(q.length < 3) return;
        const r = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${q}`);
        const data = await r.json();
        const list = document.getElementById('cityList');
        list.innerHTML = ''; list.style.display = 'block';
        data.slice(0, 5).forEach(c => {
            let div = document.createElement('div');
            div.className = 'city-opt';
            div.innerText = c.display_name;
            div.onclick = () => {
                document.getElementById('cityName').value = c.display_name.split(',')[0];
                document.getElementById('lat').value = c.lat;
                document.getElementById('lng').value = c.lon;
                list.style.display = 'none';
            };
            list.appendChild(div);
        });
    }

    async function fetchAstro() {
        const url = `https://hemantpurohit27.pythonanywhere.com/get_kundli?date=${document.getElementById('date').value}&time=${document.getElementById('time').value}&lat=${document.getElementById('lat').value}&lng=${document.getElementById('lng').value}`;
        const res = await fetch(url);
        const data = await res.json();
        if(data.status === "error") { alert("‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§è‡§∞‡§∞: " + data.message); return; }
        
        renderAll(data);
    }

    function renderAll(data) {
        const p = data.panchang;
        let html = `<h3>‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó ‡§µ‡§ø‡§µ‡§∞‡§£‡•Ä</h3><div class="card panchang-grid">
            <div class="pan-item"><b>‡§µ‡§æ‡§∞:</b><br>${p.var}</div>
            <div class="pan-item"><b>‡§§‡§ø‡§•‡§ø:</b><br>${p.tithi}</div>
            <div class="pan-item"><b>‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞:</b><br>${p.nakshatra}</div>
            <div class="pan-item"><b>‡§Ø‡•ã‡§ó/‡§ï‡§∞‡§£:</b><br>${p.yog}/${p.karan}</div>
            <div class="pan-item"><b>‡§∏‡•Ç‡§∞‡•ç‡§Ø ‡§∞‡§æ‡§∂‡§ø:</b><br>${p.sury_rashi}</div>
            <div class="pan-item"><b>‡§∏‡§Æ‡§Ø:</b><br>${p.time}</div>
        </div>`;
        document.getElementById('result-area').innerHTML = html;
    }
</script>
</body>
</html>
