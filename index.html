<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>KP Professional Astrology v18.0</title>
    <style>
        body { background: #050a14; color: #e2e8f0; font-family: sans-serif; padding: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: #1a202c; padding: 20px; border-radius: 10px; border: 1px solid #4a5568; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; border: 1px solid #2d3748; text-align: left; font-size: 14px; }
        th { background: #2d3748; color: #f6ad55; }
        .chart-svg { background: white; border-radius: 8px; padding: 10px; width: 100%; max-width: 400px; }
        h2 { color: #f6ad55; text-align: center; }
    </style>
</head>
<body>

    <h2>KP SYSTEM (PLACIDUS) SOFTWARE</h2>

    <div class="card" style="margin-bottom:20px; display:flex; gap:10px; justify-content:center;">
        <input type="date" id="date" value="2006-11-06">
        <input type="time" id="time" value="11:28">
        <input type="text" id="lat" value="24.58" style="width:60px">
        <input type="text" id="lng" value="73.71" style="width:60px">
        <button onclick="calculateKP()" style="background:#f6ad55; border:none; padding:10px 20px; cursor:pointer; font-weight:bold;">KP गणना करें</button>
    </div>

    <div class="grid">
        <div class="card">
            <h3>KP House Cusps (भाव चलित तालिका)</h3>
            <table id="cusp_table">
                <thead><tr><th>Cusp (भाव)</th><th>Sign (राशि)</th><th>Degree (अंश)</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="card">
            <h3>Planet Positions (ग्रह स्थिति)</h3>
            <table id="planet_table">
                <thead><tr><th>ग्रह</th><th>राशि</th><th>अंश</th><th>भाव (House)</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div class="card" style="margin-top:20px; text-align:center;">
        <h3>KP Lagna Chart</h3>
        <div id="chart_area" style="display:flex; justify-content:center;"></div>
    </div>

<script>
    async function calculateKP() {
        const url = `https://hemantpurohit27.pythonanywhere.com/api/kp_kundli?date=${document.getElementById('date').value}&time=${document.getElementById('time').value}&lat=${document.getElementById('lat').value}&lng=${document.getElementById('lng').value}`;
        const res = await fetch(url);
        const data = await res.json();

        // 1. Cusp Table
        let cHtm = "";
        data.cusps.forEach(c => {
            cHtm += `<tr><td>भाव ${c.no}</td><td>${c.sign}</td><td>${c.degree}</td></tr>`;
        });
        document.querySelector("#cusp_table tbody").innerHTML = cHtm;

        // 2. Planet Table
        let pHtm = "";
        data.planets.forEach(p => {
            pHtm += `<tr><td>${p.name}</td><td>${p.sign}</td><td>${p.degree}</td><td>${p.house}</td></tr>`;
        });
        document.querySelector("#planet_table tbody").innerHTML = pHtm;

        // 3. Chart Drawing (Uses the same SVG logic from previous versions)
        document.getElementById('chart_area').innerHTML = drawNorthChart(data.ascendant, data.planets);
    }

    function drawNorthChart(lagna, planets) {
        // SVG Logic (Condensed for brevity)
        const h = {1:[150,80], 2:[75,40], 3:[40,75], 4:[100,150], 5:[40,225], 6:[75,260], 7:[150,220], 8:[225,260], 9:[260,225], 10:[200,150], 11:[260,75], 12:[225,40]};
        let svg = `<svg viewBox="0 0 300 300" class="chart-svg"><path d="M0 0 L300 300 M300 0 L0 300 M150 0 L0 150 L150 300 L300 150 Z" stroke="black" fill="none" stroke-width="2"/><rect width="300" height="300" fill="none" stroke="black" stroke-width="3"/>`;
        for(let i=1; i<=12; i++) {
            let r = ((lagna + i - 2) % 12) + 1;
            svg += `<text x="${h[i][0]}" y="${h[i][1]}" fill="red" font-weight="bold" font-size="18" text-anchor="middle">${r}</text>`;
        }
        planets.forEach(p => {
            svg += `<text x="${h[p.house][0]}" y="${h[p.house][1]+20}" fill="blue" font-size="12" font-weight="bold" text-anchor="middle">${p.name.substring(0,2)}</text>`;
        });
        return svg + "</svg>";
    }
</script>
</body>
</html>
