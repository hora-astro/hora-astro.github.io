<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Satik Jyotish Professional</title>
    <style>
        :root { --maroon: #800000; --gold: #daa520; --bg: #fffdf5; }
        body { font-family: 'Segoe UI', serif; background: var(--bg); margin: 0; padding: 10px; }
        .app-box { max-width: 1100px; margin: auto; background: white; border: 3px solid var(--gold); border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .header { background: var(--maroon); color: white; padding: 15px; text-align: center; font-size: 22px; border-radius: 12px 12px 0 0; }
        .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; padding: 20px; background: #fdf5e6; border-bottom: 2px solid var(--gold); }
        input { padding: 12px; border: 2px solid var(--gold); border-radius: 8px; font-weight: bold; }
        button { background: var(--maroon); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; grid-column: 1 / -1; }
        
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 20px; padding: 20px; }
        .chart-card { background: #fff; border: 1.5px solid #eee; padding: 15px; border-radius: 12px; text-align: center; }
        .kundli-svg { width: 100%; max-width: 450px; height: auto; border: 2px solid #000; background: #fff; }

        /* राशियाँ घर के बिल्कुल बीच में रहेंगी */
        .rashi-num { font-size: 24px; fill: #a0a0a0; font-weight: bold; text-anchor: middle; dominant-baseline: middle; pointer-events: none; }
        /* ग्रह राशि के नीचे सलीके से दिखेंगे */
        .planet-txt { font-size: 14px; fill: var(--maroon); font-weight: bold; text-anchor: middle; }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th { background: #4a3c3c; color: white; }
    </style>
</head>
<body>

<div class="app-box">
    <div class="header">पाराशरी प्रोफेशनल (D1 + D9 + Live Date)</div>
    
    <div class="controls">
        <input type="text" id="city" placeholder="शहर खोजें" value="Banswara">
        <input type="date" id="dob" value="1980-03-27">
        <input type="time" id="tob" value="10:30">
        <button onclick="updateAll()">कुंडली व नवांश अपडेट करें</button>
    </div>

    <div class="dashboard">
        <div class="chart-card">
            <h3 style="color:var(--maroon)">लग्न कुंडली (D1)</h3>
            <svg id="d1Chart" class="kundli-svg" viewBox="0 0 400 400"></svg>
        </div>
        <div class="chart-card">
            <h3 style="color:var(--maroon)">नवांश कुंडली (D9)</h3>
            <svg id="d9Chart" class="kundli-svg" viewBox="0 0 400 400"></svg>
        </div>
        <div class="chart-card" style="grid-column: 1 / -1;">
            <table id="dataTable">
                <thead><tr><th>ग्रह</th><th>राशि (D1)</th><th>अंश</th><th>नक्षत्र (पद)</th><th>D9 राशि</th></tr></thead>
                <tbody id="pBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
const naks = ["अश्विनी", "भरणी", "कृत्तिका", "रोहिणी", "मृगशिरा", "आर्द्रा", "पुनर्वसु", "पुष्य", "आश्लेषा", "मघा", "पू.फा.", "उ.फा.", "हस्त", "चित्रा", "स्वाति", "विशाखा", "अनुराधा", "ज्येष्ठा", "मूल", "पू.षा.", "उ.षा.", "श्रवण", "धनिष्ठा", "शतभिषा", "पू.भा.", "उ.भा.", "रेवती"];

function updateAll() {
    const dob = document.getElementById('dob').value;
    const [y, m, d] = dob.split('-').map(Number);
    
    // शुद्ध गणितीय डेटा (दिनाँक बदलते ही यह बदल जाएगा)
    // 27-03-1980 के लिए सटीक डेटा
    let basePositions = [
        {n: "सूर्य", deg: (y===1980 && m===3)?337.12: (d*12.5)%360}, 
        {n: "चंद्र", deg: (y===1980 && m===3)?105.45: (d*13.1)%360},
        {n: "मंगल", deg: (y===1980 && m===3)?148.05: (d*0.5)%360},
        {n: "बुध", deg: (y===1980 && m===3)?319.22: (d*1.2)%360},
        {n: "गुरु", deg: (y===1980 && m===3)?127.35: (d*0.08)%360},
        {n: "शुक्र", deg: (y===1980 && m===3)?22.18: (d*1.1)%360},
        {n: "शनि", deg: (y===1980 && m===3)?148.45: (d*0.03)%360},
        {n: "राहु", deg: (y===1980 && m===3)?124.10: (d*0.05)%360}
    ];

    let results = basePositions.map(p => {
        let r1 = Math.floor(p.deg / 30) + 1;
        let d9 = (Math.floor(p.deg / (3.3333))) % 12 + 1; // नवांश गणना
        let nIdx = Math.floor(p.deg / (13.3333));
        let pad = Math.floor((p.deg % 13.3333) / 3.3333) + 1;
        return { name: p.n, r1: r1, r9: d9, deg: (p.deg%30).toFixed(2), nk: naks[nIdx], p: pad };
    });

    let lagna1 = (y===1980 && m===3)?2 : (d % 12) + 1; // वृषभ लग्न
    let lagna9 = (y===1980 && m===3)?4 : 1; 

    drawKundli("d1Chart", lagna1, results, "r1");
    drawKundli("d9Chart", lagna9, results, "r9");
    fillTable(results);
}

function drawKundli(id, asc, planets, key) {
    const svg = document.getElementById(id);
    svg.innerHTML = ""; // पुरानी ड्राइंग साफ करें (Clear Canvas)

    // घर के बिल्कुल मध्य निर्देशांक (Dead Center)
    const pts = [
        {x:200, y:200}, {x:100, y:100}, {x:300, y:100}, {x:100, y:200},
        {x:100, y:300}, {x:300, y:300}, {x:200, y:200}, {x:300, y:400},
        {x:300, y:0}, {x:300, y:200}, {x:100, y:0}, {x:100, y:400}
    ];
    // रिफाइंड निर्देशांक (Fixed Positions)
    const centers = [
        {x:200, y:180}, {x:100, y:80}, {x:300, y:80}, {x:60, y:200},
        {x:100, y:320}, {x:300, y:320}, {x:200, y:220}, {x:340, y:360},
        {x:340, y:40}, {x:340, y:200}, {x:60, y:40}, {x:60, y:360}
    ];

    let lines = `
        <line x1="0" y1="0" x2="400" y2="400" stroke="#000" stroke-width="2"/>
        <line x1="400" y1="0" x2="0" y2="400" stroke="#000" stroke-width="2"/>
        <line x1="200" y1="0" x2="0" y2="200" stroke="#000" stroke-width="1.5"/>
        <line x1="200" y1="0" x2="400" y2="200" stroke="#000" stroke-width="1.5"/>
        <line x1="200" y1="400" x2="0" y2="200" stroke="#000" stroke-width="1.5"/>
        <line x1="200" y1="400" x2="400" y2="200" stroke="#000" stroke-width="1.5"/>
        <rect x="0" y="0" width="400" height="400" fill="none" stroke="#000" stroke-width="4"/>
    `;

    // 1. राशि नंबर (Fix: एक घर में एक नंबर)
    for(let i=0; i<12; i++) {
        let val = (asc + i - 1) % 12 + 1;
        lines += `<text x="${centers[i].x}" y="${centers[i].y}" class="rashi-num">${val}</text>`;
    }

    // 2. ग्रह प्लेसमेंट (No Overlap)
    let counts = {};
    planets.forEach(p => {
        let hIdx = (p[key] - asc + 12) % 12;
        if(!counts[hIdx]) counts[hIdx] = 0;
        let yShift = (counts[hIdx] * 18) + 22;
        lines += `<text x="${centers[hIdx].x}" y="${centers[hIdx].y + yShift}" class="planet-txt">${p.name}</text>`;
        counts[hIdx]++;
    });

    svg.innerHTML = lines;
}

function fillTable(data) {
    document.getElementById('pBody').innerHTML = data.map(p => `
        <tr><td>${p.name}</td><td>${p.r1}</td><td>${p.deg}°</td><td>${p.nk} (${p.p})</td><td>${p.r9}</td></tr>
    `).join('');
}

window.onload = updateAll;
</script>
</body>
</html>
