<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siddhanta Astro - Self Powered</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root { --maroon: #800000; --gold: #daa520; --bg: #fffcf5; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f0f0; margin: 0; padding: 10px; }
        
        .setup-box { background: white; padding: 20px; border-radius: 8px; max-width: 800px; margin: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-top: 5px solid var(--maroon); }
        .input-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 15px; }
        input, button { padding: 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        button { background: var(--maroon); color: white; cursor: pointer; border: none; font-weight: bold; transition: 0.3s; }
        button:hover { background: #a00000; }

        #report-area { margin-top: 20px; display: none; }
        .pdf-page { width: 210mm; min-height: 297mm; background: white; margin: auto; padding: 15mm; box-sizing: border-box; box-shadow: 0 0 10px rgba(0,0,0,0.2); }
        
        .header { text-align: center; border: 3px double var(--maroon); padding: 10px; background: var(--bg); margin-bottom: 20px; }
        .chart-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .chart-box { border: 2px solid var(--maroon); padding: 10px; text-align: center; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
        th, td { border: 1px solid #999; padding: 10px; text-align: center; }
        th { background: #fdf2f2; color: var(--maroon); }

        .prediction-card { background: #fffdf0; border-left: 5px solid var(--gold); padding: 15px; margin-top: 15px; font-size: 15px; line-height: 1.6; }
    </style>
</head>
<body>

<div class="setup-box">
    <h2 style="text-align:center; color:var(--maroon); margin-top:0;">॥ भाग्य विधाता एस्ट्रो सॉफ्टवेयर ॥</h2>
    <div class="input-row">
        <input type="text" id="custName" value="हेमंत पुरोहित" placeholder="नाम">
        <input type="date" id="dob" value="1980-03-27">
        <input type="time" id="tob" value="10:30">
    </div>
    <div class="input-row">
        <input type="text" id="city" value="Banswara" placeholder="शहर">
        <input type="number" id="lat" value="23.54" step="0.01" placeholder="Lat">
        <input type="number" id="lon" value="74.47" step="0.01" placeholder="Lon">
    </div>
    <button onclick="generateLocalKundli()" style="width: 100%;">कुंडली जेनरेट करें (No Server)</button>
</div>

<div id="report-area">
    <div class="pdf-page" id="capture-this">
        <div class="header">
            <h1 style="margin:0; color:var(--maroon);">॥ श्री गणेशाय नमः ॥</h1>
            <p style="margin:5px 0;"><b>नाम:</b> <span id="out-name"></span> | <b>जन्म तिथि:</b> <span id="out-date"></span></p>
            <p style="margin:0; font-size:12px;">FortuneWithStars सिद्धांतों पर आधारित शुद्ध गणना</p>
        </div>

        <div class="chart-grid">
            <div class="chart-box">
                <h3 style="color:var(--maroon); margin-top:0;">D1 लग्न कुंडली</h3>
                <div id="d1-svg"></div>
            </div>
            <div class="chart-box">
                <h3 style="color:var(--maroon); margin-top:0;">D9 नवांश कुंडली</h3>
                <div id="d9-svg"></div>
            </div>
        </div>

        <table id="p-table">
            <thead>
                <tr>
                    <th>ग्रह</th>
                    <th>अंश (Degree)</th>
                    <th>भाव (House)</th>
                    <th>राशि</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <div id="predictions" class="prediction-card"></div>
    </div>
    <div style="text-align:center; margin: 20px;">
        <button onclick="savePDF()" style="background:green; padding:15px 40px;">PDF डाउनलोड करें</button>
    </div>
</div>

<style>
    .status-ex { color: #1a73e8; font-weight: bold; } /* उच्च ग्रह के लिए नीला */
    .status-db { color: #d93025; font-weight: bold; } /* नीच ग्रह के लिए लाल */
    .lagna-intro { background: #fff8e1; border: 1px solid #ffe082; padding: 15px; margin-bottom: 15px; border-radius: 5px; }
</style>

<script>
// उच्च और नीच राशियों का डेटा
const EX_DB_DATA = {
    "सूर्य": { ex: 1, db: 7 }, "चंद्र": { ex: 2, db: 8 }, "मंगल": { ex: 10, db: 4 },
    "बुध": { ex: 6, db: 12 }, "गुरु": { ex: 4, db: 10 }, "शुक्र": { ex: 12, db: 6 },
    "शनि": { ex: 7, db: 1 }
};

// FortuneWithStars के आधार पर लग्न फलादेश डेटा
const LAGNA_DATA = {
    1: { name: "मेष", swami: "मंगल", phal: "मेष लग्न के लिए मंगल, सूर्य और गुरु अत्यंत शुभ होते हैं। शुक्र, बुध और शनि मारक प्रभाव दे सकते हैं।" },
    2: { name: "वृष", swami: "शुक्र", phal: "वृष लग्न में शनि परम राजयोगकारक ग्रह है। बुध और शुक्र भी शुभ फल देते हैं, जबकि गुरु और मंगल अशुभ।" },
    3: { name: "मिथुन", swami: "बुध", phal: "मिथुन लग्न के लिए बुध, शुक्र और शनि मित्र ग्रह हैं। मंगल और गुरु इस लग्न के लिए शुभ नहीं माने जाते।" },
    4: { name: "कर्क", swami: "चंद्र", phal: "कर्क लग्न में मंगल योगकारक होकर जीवन में सफलता दिलाता है। गुरु और चंद्र भी शुभ होते हैं।" },
    5: { name: "सिंह", swami: "सूर्य", phal: "सिंह लग्न के लिए सूर्य, मंगल और गुरु शुभ फलदायी हैं। शनि और शुक्र यहाँ मारक बन सकते हैं।" },
    6: { name: "कन्या", swami: "बुध", phal: "कन्या लग्न के लिए बुध और शुक्र की युति राजयोग बनाती है। मंगल यहाँ सबसे अशुभ फल देता है।" },
    7: { name: "तुला", swami: "शुक्र", phal: "तुला लग्न के लिए शनि सबसे बलवान योगकारक ग्रह है। बुध और शुक्र भी समृद्धिदायक होते हैं।" },
    8: { name: "वृश्चिक", swami: "मंगल", phal: "वृश्चिक लग्न के लिए चंद्र और गुरु अत्यंत शुभ हैं। मंगल लग्नेश होकर सफलता प्रदान करता है।" },
    9: { name: "धनु", swami: "गुरु", phal: "धनु लग्न के लिए सूर्य और मंगल राजयोग कारक हैं। गुरु स्वयं शुभ फल देता है।" },
    10: { name: "मकर", swami: "शनि", phal: "मकर लग्न के लिए शुक्र सबसे बड़ा मित्र और योगकारक ग्रह है। बुध भी अनुकूल परिणाम देता है।" },
    11: { name: "कुम्भ", swami: "शनि", phal: "कुम्भ लग्न के लिए शुक्र और बुध शुभ होते हैं। लग्नेश शनि स्वयं अनुशासन और उन्नति देता है।" },
    12: { name: "मीन", swami: "गुरु", phal: "मीन लग्न के लिए मंगल और चंद्र अत्यंत शुभ हैं। गुरु लग्नेश होकर ज्ञान और समृद्धि देता है।" }
};

function generateLocalKundli() {
    // ... पुरानी गणना का हिस्सा ... (पिछली बार वाला लॉजिक)
    
    let tableBody = "";
    let processedPlanets = planets.map(p => {
        let signIdx = Math.floor(p.d / 30) + 1; // 1 to 12
        let house = (signIdx - lagna + 13) % 12;
        if(house === 0) house = 12;

        // उच्च/नीच चेक करें
        let status = "";
        let statusClass = "";
        if(EX_DB_DATA[p.n]) {
            if(signIdx === EX_DB_DATA[p.n].ex) { status = "(उच्च)"; statusClass = "status-ex"; }
            if(signIdx === EX_DB_DATA[p.n].db) { status = "(नीच)"; statusClass = "status-db"; }
        }
        
        tableBody += `<tr><td>${p.n} <span class="${statusClass}">${status}</span></td><td>${(p.d % 30).toFixed(2)}°</td><td>${house}</td><td>${signs_hi[signIdx-1]}</td></tr>`;
        
        return { name: p.n, house: house, d9: Math.floor((p.d % 30) / (3.33)) + 1 };
    });

    document.querySelector("#p-table tbody").innerHTML = tableBody;

    // लग्न फलादेश सेक्शन अपडेट करें
    const lData = LAGNA_DATA[lagna];
    document.getElementById('predictions').innerHTML = `
        <div class="lagna-intro">
            <h3 style="margin-top:0; color:var(--maroon); border-bottom:1px solid #ccc;">${lData.name} लग्न फलादेश (FortuneWithStars सिद्धांतों पर आधारित)</h3>
            <p><b>स्वामी:</b> ${lData.swami} | <b>प्रकृति:</b> ${lData.phal}</p>
        </div>
        <p>आपकी कुंडली के विश्लेषण के अनुसार, लग्नेश <b>${lData.swami}</b> की स्थिति और ग्रहों का गोचर आपके जीवन की दिशा तय करेगा।</p>
    `;

    // चार्ट ड्रॉ करें
    drawNorthChart("d1-svg", lagna, processedPlanets, 'house');
    drawNorthChart("d9-svg", 5, processedPlanets, 'd9');
    
    document.getElementById('report-area').style.display = 'block';
}
</script>
</body>
</html>
