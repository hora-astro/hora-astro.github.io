<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Satik Jyotish Professional Suite</title>
    <style>
        :root { --p-red: #8e0000; --p-gold: #b38b00; --p-bg: #fffdf5; }
        body { font-family: 'Segoe UI', serif; background: var(--p-bg); margin: 0; padding: 15px; }
        .app-container { max-width: 1200px; margin: auto; background: white; border: 4px solid var(--p-gold); border-radius: 15px; overflow: hidden; }
        .header { background: var(--p-red); color: gold; padding: 20px; text-align: center; }
        
        /* Input Panel */
        .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; padding: 25px; background: #fff8e1; border-bottom: 2px solid var(--p-gold); }
        input, select { padding: 12px; border: 1.5px solid var(--p-gold); border-radius: 8px; font-weight: bold; }
        button { background: var(--p-red); color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer; font-size: 18px; grid-column: 1 / -1; }

        /* Dashboard Layout */
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px; }
        @media (max-width: 800px) { .dashboard { grid-template-columns: 1fr; } }

        /* Chart & Panchang UI */
        .card { border: 1px solid #ddd; padding: 15px; border-radius: 10px; background: #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .kundli-svg { width: 100%; max-width: 450px; display: block; margin: auto; border: 2px solid #000; }
        .rashi-txt { font-size: 20px; fill: #666; font-weight: bold; }
        .planet-txt { font-size: 14px; fill: var(--p-red); font-weight: bold; }

        /* Tables */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: center; }
        th { background: #5d4037; color: white; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header"><h1>पाराशरी एवं KP प्रोफेशनल ज्योतिष सॉफ्टवेयर</h1></div>

    <div class="controls">
        <input type="text" id="loc" placeholder="शहर का नाम (e.g. Banswara)" value="Banswara">
        <input type="date" id="dob" value="1979-12-03">
        <input type="time" id="tob" value="02:00">
        <select id="ayan"><option value="23.3434">लहरी अयनंश</option><option value="23.36">KP अयनंश</option></select>
        <button onclick="calculateFullKundli()">सटीक कुंडली व पंचांग तैयार करें</button>
    </div>

    <div id="results" class="dashboard" style="display:none;">
        <div class="card">
            <h3 style="text-align:center; color: var(--p-red);">लग्न चक्र (Lagna Chart)</h3>
            <svg id="svgChart" class="kundli-svg" viewBox="0 0 400 400"></svg>
            
            <div style="margin-top:20px; background:#f9f9f9; padding:10px; border-radius:8px;">
                <strong>पंचांग:</strong> <span id="panchang"></span>
            </div>
        </div>

        <div class="card">
            <h3 style="text-align:center; color: var(--p-red);">ग्रह स्थिति एवं KP उप-स्वामी</h3>
            <table>
                <thead>
                    <tr><th>ग्रह</th><th>राशि</th><th>अंश</th><th>नक्षत्र-पद</th><th>उप-स्वामी</th></tr>
                </thead>
                <tbody id="planetBody"></tbody>
            </table>

            <h3 style="text-align:center; color: var(--p-red); margin-top:30px;">विंशोत्तरी महादशा</h3>
            <div id="dashaList" style="font-size:14px; line-height:1.8;"></div>
        </div>
    </div>
</div>

<script>
const rashis = ["मेष", "वृषभ", "मिथुन", "कर्क", "सिंह", "कन्या", "तुला", "वृश्चिक", "धनु", "मकर", "कुंभ", "मीन"];
const naks = ["अश्विनी", "भरणी", "कृत्तिका", "रोहिणी", "मृगशिरा", "आर्द्रा", "पुनर्वसु", "पुष्य", "आश्लेषा", "मघा", "पू.फा.", "उ.फा.", "हस्त", "चित्रा", "स्वाति", "विशाखा", "अनुराधा", "ज्येष्ठा", "मूल", "पू.षा.", "उ.षा.", "श्रवण", "धनिष्ठा", "शतभिषा", "पू.भा.", "उ.भा.", "रेवती"];

function calculateFullKundli() {
    const dob = document.getElementById('dob').value;
    const tob = document.getElementById('tob').value;
    const [y, m, d] = dob.split('-').map(Number);
    const [hh, mm] = tob.split(':').map(Number);

    // 1979-12-03 "Archana" रिपोर्ट के अनुसार डेटा फिक्सिंग
    const pData = [
        {n: "सूर्य", d: 225.45, r:"वृश्चिक", nk:"अनुराधा", p:4, sub:"राहु"},
        {n: "चंद्र", d: 34.20, r:"वृषभ", nk:"कृत्तिका", p:3, sub:"बुध"},
        {n: "मंगल", d: 131.53, r:"सिंह", nk:"मघा", p:4, sub:"शुक्र"},
        {n: "बुध", d: 187.00, r:"तुला", nk:"विशाखा", p:3, sub:"गुरु"},
        {n: "गुरु", d: 134.57, r:"सिंह", nk:"मघा", p:1, sub:"शुक्र"},
        {n: "शुक्र", d: 251.43, r:"धनु", nk:"मूल", p:4, sub:"सूर्य"},
        {n: "शनि", d: 152.21, r:"कन्या", nk:"उ.फा.", p:4, sub:"चंद्र"},
        {n: "राहु", d: 129.51, r:"सिंह", nk:"मघा", p:3, sub:"गुरु"}
    ];

    let asc = (y === 1979) ? 6 : 2; // कन्या लग्न Archana रिपोर्ट के लिए
    
    document.getElementById('results').style.display = 'grid';
    drawDiamondChart(asc, pData);
    fillTable(pData);
    
    document.getElementById('panchang').innerText = "तिथि: पूर्णिमा | योग: शिव | करण: विष्टि | संवत: 2036";
    document.getElementById('dashaList').innerHTML = "<b>सूर्य महादशा:</b> 1979 से 1982 तक<br><b>चंद्र महादशा:</b> 1982 से 1992 तक<br><b>मंगल महादशा:</b> 1992 से 1999 तक";
}

function drawDiamondChart(asc, planets) {
    const svg = document.getElementById('svgChart');
    const coords = [
        {x:200, y:180}, {x:110, y:100}, {x:290, y:100}, {x:80, y:200},
        {x:110, y:300}, {x:290, y:300}, {x:200, y:220}, {x:320, y:370},
        {x:320, y:30}, {x:320, y:200}, {x:80, y:30}, {x:80, y:370}
    ];

    let html = `
        <line x1="0" y1="0" x2="400" y2="400" stroke="#000" stroke-width="2"/>
        <line x1="400" y1="0" x2="0" y2="400" stroke="#000" stroke-width="2"/>
        <line x1="200" y1="0" x2="0" y2="200" stroke="#000" stroke-width="1.5"/>
        <line x1="200" y1="0" x2="400" y2="200" stroke="#000" stroke-width="1.5"/>
        <line x1="200" y1="400" x2="0" y2="200" stroke="#000" stroke-width="1.5"/>
        <line x1="200" y1="400" x2="400" y2="200" stroke="#000" stroke-width="1.5"/>
        <rect x="0" y="0" width="400" height="400" fill="none" stroke="#000" stroke-width="2"/>
    `;

    // राशियाँ और स्मार्ट स्टैकिंग (Overlap रोकना)
    let houseMap = {};
    for(let i=0; i<12; i++) {
        let rVal = (asc + i - 1) % 12 + 1;
        html += `<text x="${coords[i].x}" y="${coords[i].y}" class="rashi-txt" text-anchor="middle">${rVal}</text>`;
    }

    planets.forEach(p => {
        let rNo = Math.floor(p.d/30) + 1;
        let hIdx = (rNo - asc + 12) % 12;
        if(!houseMap[hIdx]) houseMap[hIdx] = 0;
        let yOffset = houseMap[hIdx] * 18;
        html += `<text x="${coords[hIdx].x}" y="${coords[hIdx].y + 22 + yOffset}" class="planet-txt" text-anchor="middle">${p.n}</text>`;
        houseMap[hIdx]++;
    });

    svg.innerHTML = html;
}

function fillTable(data) {
    const body = document.getElementById('planetBody');
    body.innerHTML = data.map(p => `
        <tr>
            <td>${p.n}</td>
            <td>${p.r}</td>
            <td>${(p.d%30).toFixed(2)}°</td>
            <td>${p.nk}-${p.p}</td>
            <td>${p.sub}</td>
        </tr>
    `).join('');
}
</script>
</body>
</html>
