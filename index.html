<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Saty-Vani Master Kundli</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { --main: #8b0000; --gold: #b45309; }
        body { background: #0f172a; color: white; font-family: 'Segoe UI', sans-serif; padding: 20px; }
        .input-panel { max-width: 900px; margin: auto; background: #1e293b; padding: 20px; border-radius: 12px; border: 2px solid var(--gold); }
        .row { display: flex; gap: 10px; margin-bottom: 10px; }
        input { flex: 1; padding: 12px; border-radius: 8px; border: none; }
        .report { background: white; color: black; max-width: 850px; margin: 30px auto; padding: 40px; border: 10px double var(--main); display: none; }
        .panchang-strip { background: #fffbeb; padding: 10px; border: 1px solid #fde68a; display: flex; justify-content: space-around; font-weight: bold; margin-bottom: 20px; }
        .charts { display: flex; gap: 20px; }
        .chart-box { border: 2px solid var(--main); flex: 1; padding: 10px; background: #fffaf0; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: var(--main); color: white; padding: 8px; }
        td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    </style>
</head>
<body>

<div class="input-panel">
    <div class="row">
        <input type="text" id="name" placeholder="नाम">
        <input type="text" id="location" placeholder="शहर खोजें (उदा: Banswara)">
    </div>
    <div class="row">
        <input type="date" id="date" value="1980-03-27">
        <input type="time" id="time" value="08:10">
        <button onclick="generate()" style="background:var(--gold); color:white; border:none; padding:10px 30px; border-radius:8px; cursor:pointer; font-weight:bold;">कुंडली प्राप्त करें</button>
    </div>
</div>

<div id="report" class="report">
    <h1 align="center" style="color:var(--main); margin:0;">॥ जन्म कुंडली एवं पंचांग ॥</h1>
    <p align="center" id="meta-head"></p>

    <div class="panchang-strip" id="panchang"></div>

    <div class="charts">
        <div class="chart-box">
            <h3 align="center">लग्न कुंडली (D1)</h3>
            <div id="d1"></div>
        </div>
        <div class="chart-box">
            <h3 align="center">नवांश कुंडली (D9)</h3>
            <div id="d9"></div>
        </div>
    </div>

    <table>
        <thead><tr><th>ग्रह</th><th>राशि</th><th>अंश</th><th>भाव</th></tr></thead>
        <tbody id="p-table"></tbody>
    </table>

    <div style="margin-top:20px; background:#fdf2f2; padding:15px; border-left:5px solid var(--main);">
        <b>फलादेश:</b> <span id="prediction"></span>
    </div>
</div>

<script>
    let lat = 24.58, lng = 73.71; // Default Banswara

    // Initialize Location Search
    const autocomplete = new google.maps.places.Autocomplete(document.getElementById('location'));
    autocomplete.addListener('place_changed', () => {
        const place = autocomplete.getPlace();
        lat = place.geometry.location.lat();
        lng = place.geometry.location.lng();
    });

    async function generate() {
        const d = document.getElementById('date').value;
        const t = document.getElementById('time').value;
        const res = await fetch(`https://heman.pythonanywhere.com/api/master_kundli?date=${d}&time=${t}&lat=${lat}&lng=${lng}`);
        const data = await res.json();

        document.getElementById('report').style.display = 'block';
        document.getElementById('panchang').innerHTML = `तिथि: ${data.panchang.tithi} (${data.panchang.paksha}) | नक्षत्र: ${data.panchang.nakshtra}`;
        
        draw("d1", data.asc, data.planets);
        // ... (Table and D9 rendering logic)
    }

    function draw(container, asc, planets) {
        // ... (SVG Drawing logic as per previous versions)
    }
</script>
</body>
</html>
