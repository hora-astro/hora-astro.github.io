<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hora Astro Pro</title>
    <style>
        :root { --primary: #d35400; --dark-bg: #1a0f00; --card-bg: #2d1d10; --text: #fdf2e9; }
        body { font-family: sans-serif; background: var(--dark-bg); color: var(--text); margin: 0; padding: 10px; text-align: center; }
        .container { max-width: 500px; margin: auto; }
        .card { background: var(--card-bg); padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #4e342e; }
        input { width: 100%; padding: 12px; margin: 5px 0; border-radius: 8px; border: none; background: #3e2723; color: white; box-sizing: border-box; }
        
        .tab-menu { display: flex; gap: 5px; margin: 15px 0; overflow-x: auto; }
        .tab { flex: 1; padding: 10px; background: #3e2723; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: bold; white-space: nowrap; }
        .tab.active { background: var(--primary); }

        .chart-svg { width: 100%; background: white; border: 2px solid #000; border-radius: 4px; margin-top: 10px; }
        .planet-txt { font-size: 9px; font-weight: bold; fill: #1a237e; }
        .rashi-txt { font-size: 16px; font-weight: bold; fill: #b71c1c; }
        
        .option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .opt-item { background: var(--card-bg); padding: 15px; border-radius: 12px; border: 1px solid #4e342e; }
        .btn-load { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="color: var(--primary);">Hora Astro Pro üåå</h2>
    
    <div class="card">
        <div style="display: flex; gap: 5px;">
            <input type="date" id="date" value="2006-11-06">
            <input type="time" id="time" value="11:28">
        </div>
        <input type="text" id="city" placeholder="Banswara, Rajasthan">
        <button class="btn-load" onclick="fetchData()">‡§°‡§æ‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</button>
    </div>

    <div class="tab-menu">
        <div class="tab active" onclick="showChart('d1', this)">D1 (‡§≤‡§ó‡•ç‡§®)</div>
        <div class="tab" onclick="showChart('d9', this)">D9 (‡§®‡§µ‡§æ‡§Ç‡§∂)</div>
        <div class="tab" onclick="showPanchang(this)">‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó</div>
        <div class="tab">‡§Æ‡§ø‡§≤‡§æ‡§®</div>
    </div>

    <div id="display-area"></div>

    <div class="option-grid">
        <div class="opt-item">üé°<br><b>‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä</b></div>
        <div class="opt-item">üìÖ<br><b>‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó</b></div>
        <div class="opt-item">üë´<br><b>‡§Æ‡§ø‡§≤‡§æ‡§®</b></div>
        <div class="opt-item">üóìÔ∏è<br><b>‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞</b></div>
    </div>
</div>

<script>
    async function fetchData() {
        const url = `https://hemantpurohit27.pythonanywhere.com/get_kundli?date=${document.getElementById('date').value}&time=${document.getElementById('time').value}&lat=23.49&lng=74.35`;
        const res = await fetch(url);
        window.data = await res.json();
        showChart('d1', document.querySelector('.active'));
    }

    function showChart(type, el) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        if(!window.data) return;
        
        const chartData = type === 'd1' ? window.data.d1 : window.data.d9;
        const title = type === 'd1' ? "‡§≤‡§ó‡•ç‡§® ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä (D1)" : "‡§®‡§µ‡§æ‡§Ç‡§∂ ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä (D9)";
        document.getElementById('display-area').innerHTML = `<h3>${title}</h3>` + renderSVG(chartData, type);
    }

    function renderSVG(chart, type) {
        const coords = { 1:[150,90], 2:[80,45], 3:[45,80], 4:[95,150], 5:[45,220], 6:[80,255], 7:[150,210], 8:[220,255], 9:[255,220], 10:[205,150], 11:[255,80], 12:[220,45] };
        let svg = `<svg viewBox="0 0 300 300" class="chart-svg">
            <line x1="0" y1="0" x2="300" y2="300" stroke="#000"/><line x1="300" y1="0" x2="0" y2="300" stroke="#000"/>
            <line x1="150" y1="0" x2="0" y2="150" stroke="#000"/><line x1="0" y1="150" x2="150" y2="300" stroke="#000"/>
            <line x1="150" y1="300" x2="300" y2="150" stroke="#000"/><line x1="300" y1="150" x2="150" y2="0" stroke="#000"/>`;

        for (let i = 1; i <= 12; i++) {
            let rashi = ((chart.lagna + i - 2) % 12) + 1;
            svg += `<text x="${coords[i][0]}" y="${coords[i][1]}" class="rashi-txt" text-anchor="middle">${rashi}</text>`;
        }

        let houseGroups = {};
        chart.planets.forEach(p => {
            let h = type === 'd1' ? p.house : p.d9_house;
            if(!houseGroups[h]) houseGroups[h] = [];
            houseGroups[h].push(p);
        });

        for (let h in houseGroups) {
            houseGroups[h].forEach((p, index) => {
                // ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§™‡•ã‡§ú‡•Ä‡§∂‡§®‡§ø‡§Ç‡§ó: ‡§ó‡•ç‡§∞‡§π‡•ã‡§Ç ‡§ï‡•ã ‡§ó‡•ç‡§∞‡§ø‡§° ‡§ï‡•Ä ‡§§‡§∞‡§π ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ
                let xOff = coords[h][0] + (index % 2 === 0 ? -20 : 20);
                let yOff = coords[h][1] + 15 + (Math.floor(index / 2) * 12);
                if(index === 0 && houseGroups[h].length === 1) xOff = coords[h][0]; // ‡§∏‡§ø‡§Ç‡§ó‡§≤ ‡§ó‡•ç‡§∞‡§π ‡§∏‡•á‡§Ç‡§ü‡§∞ ‡§Æ‡•á‡§Ç
                
                svg += `<text x="${xOff}" y="${yOff}" class="planet-txt" text-anchor="middle">${p.name} ${p.degree}¬∞</text>`;
            });
        }
        return svg + "</svg>";
    }
</script>
</body>
</html>
