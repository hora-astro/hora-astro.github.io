<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>HORA ASTRO PRECISION V80.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { --crimson: #8b0000; --gold: #b45309; }
        body { background: #0f172a; color: white; font-family: 'Segoe UI', Arial; padding: 20px; }
        .setup-box { background: #1e293b; padding: 25px; border-radius: 12px; max-width: 800px; margin: auto; border: 1px solid var(--gold); text-align: center; }
        .input-group { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 20px; }
        input { padding: 12px; border-radius: 6px; border: 1px solid #334155; background: #0f172a; color: white; width: 180px; }
        
        .report-paper { background: white; color: black; padding: 30px; width: 750px; margin: 20px auto; border: 8px double var(--crimson); display: none; }
        .chart-flex { display: flex; justify-content: space-around; margin: 20px 0; }
        .svg-container { border: 2px solid #000; width: 340px; height: 340px; background: #fff; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
        th { background: #f8fafc; color: var(--crimson); }
        
        .btn-calc { background: var(--gold); color: white; padding: 15px 40px; border: none; border-radius: 8px; cursor: pointer; font-size: 18px; font-weight: bold; }
        .btn-pdf { background: #16a34a; color: white; padding: 15px; width: 750px; margin: 10px auto; display: none; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; }
    </style>
</head>
<body>

<div class="setup-box">
    <h2 style="color:var(--gold);">üïâÔ∏è HORA ASTRO PRECISION V80.0</h2>
    <div class="input-group">
        <input type="text" id="uname" placeholder="‡§®‡§æ‡§Æ" value="Hemant Purohit">
        <input type="date" id="udate" value="1980-03-27">
        <input type="time" id="utime" value="08:10">
        <input type="text" id="ucity" placeholder="‡§∂‡§π‡§∞" value="Banswara">
    </div>
    <button class="btn-calc" onclick="generateReport()">‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
</div>

<div id="report-area" class="report-paper">
    <h1 align="center" style="color:var(--crimson); margin-bottom:10px;">‡•• ‡§ú‡§®‡•ç‡§Æ ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡••</h1>
    <p align="center" id="user-info" style="font-weight:bold;"></p>
    
    <div class="chart-flex">
        <div class="svg-container" id="d1-chart"></div>
        <div class="svg-container" id="d9-chart"></div>
    </div>

    <table id="planet-table"></table>
</div>

<button id="pdf-trigger" class="btn-pdf" onclick="downloadPDF()">üì• ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</button>

<script>
    async function generateReport() {
        const url = `https://hemantpurohit27.pythonanywhere.com/api/v80_precision?date=${document.getElementById('udate').value}&time=${document.getElementById('utime').value}&lat=24.58&lng=73.71`;
        
        try {
            const response = await fetch(url);
            const data = await response.json();

            document.getElementById('report-area').style.display = 'block';
            document.getElementById('pdf-trigger').style.display = 'block';
            document.getElementById('user-info').innerText = `‡§®‡§æ‡§Æ: ${document.getElementById('uname').value} | ‡§§‡§ø‡§•‡§ø: ${document.getElementById('udate').value} | ‡§∏‡§Æ‡§Ø: ${document.getElementById('utime').value}`;

            // D1 ‡§≤‡§ó‡•ç‡§® ‡§î‡§∞ ‡§ó‡•ç‡§∞‡§π‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§π‡•Ä ‡§∞‡•á‡§Ç‡§°‡§∞‡§ø‡§Ç‡§ó
            drawNorthChart("d1-chart", data.asc, data.planets, "‡§≤‡§ó‡•ç‡§® ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä (D1)");
            drawNorthChart("d9-chart", 9, data.planets, "‡§®‡§µ‡§æ‡§Ç‡§∂ ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä (D9)");

            // ‡§§‡§æ‡§≤‡§ø‡§ï‡§æ ‡§Ö‡§™‡§°‡•á‡§ü
            let tableHtml = `<tr><th>‡§ó‡•ç‡§∞‡§π</th><th>‡§∞‡§æ‡§∂‡§ø</th><th>‡§Ö‡§Ç‡§∂</th><th>‡§≠‡§æ‡§µ</th></tr>`;
            data.planets.forEach(p => {
                tableHtml += `<tr><td>${p.name}</td><td>${p.sign}</td><td>${p.deg}¬∞</td><td>${p.house}</td></tr>`;
            });
            document.getElementById('planet-table').innerHTML = tableHtml;

        } catch (e) {
            alert("API ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø! ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø app.py ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à‡•§");
        }
    }

    function drawNorthChart(containerId, asc, planets, title) {
        // ‡§∏‡•ç‡§•‡§ø‡§∞ ‡§≠‡§æ‡§µ‡•ã‡§Ç ‡§ï‡•á ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞ ‡§¨‡§ø‡§Ç‡§¶‡•Å (House Coordinates)
        const coords = {
            1: [170, 140], 2: [85, 70], 3: [45, 140], 4: [120, 220], 
            5: [45, 300], 6: [85, 370], 7: [170, 300], 8: [255, 370], 
            9: [340, 300], 10: [225, 220], 11: [340, 140], 12: [255, 70]
        };

        let svg = `<svg viewBox="0 0 400 400" style="width:100%; height:100%;">
            <text x="200" y="30" text-anchor="middle" font-weight="bold" font-size="20">${title}</text>
            <path d="M0 40 L400 400 M400 40 L0 400 M200 40 L0 220 L200 400 L400 220 Z" fill="none" stroke="black" stroke-width="2"/>`;
        
        for (let i = 1; i <= 12; i++) {
            // ‡§∞‡§æ‡§∂‡§ø (Red)
            let r_num = ((asc + i - 2) % 12) + 1;
            svg += `<text x="${coords[i][0]}" y="${coords[i][1]}" fill="red" font-weight="bold" font-size="18" text-anchor="middle">${r_num}</text>`;
            
            // ‡§ó‡•ç‡§∞‡§π (Blue) - ‡§∞‡§æ‡§∂‡§ø ‡§ï‡•á ‡§†‡•Ä‡§ï ‡§®‡•Ä‡§ö‡•á
            let p_names = planets.filter(p => p.house === i).map(p => p.name).join(' ');
            if(p_names) {
                svg += `<text x="${coords[i][0]}" y="${coords[i][1]+25}" fill="blue" font-size="13" font-weight="bold" text-anchor="middle">${p_names}</text>`;
            }
        }
        document.getElementById(containerId).innerHTML = svg + `</svg>`;
    }

    function downloadPDF() {
        const element = document.getElementById('report-area');
        const opt = {
            margin: 10,
            filename: 'Kundli_Precision_Report.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        html2pdf().set(opt).from(element).save();
    }
</script>
</body>
</html>
