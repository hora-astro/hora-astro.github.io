<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudarshan Kundli | Lagna & Rashi Fix</title>
    <style>
        :root { --primary: #e64a19; --bg: #fff5f2; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); text-align: center; margin: 0; padding: 10px; }
        .container { background: white; max-width: 420px; margin: auto; padding: 15px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        
        /* SVG Kundli Style */
        .kundli-svg { width: 100%; height: auto; background: #fff; border: 2.5px solid #333; margin-top: 10px; }
        .line { stroke: #333; stroke-width: 2; }
        .rashi-text { fill: #d32f2f; font-size: 16px; font-weight: bold; }
        .planet-text { fill: #000; font-size: 11px; font-weight: bold; }
        
        input, button { width: 95%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #ccc; font-size: 15px; }
        button { background: var(--primary); color: white; border: none; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <input type="text" id="date" placeholder="YYYY/MM/DD (जैसे 2006/11/06)">
    <input type="text" id="time" placeholder="HH:MM (जैसे 11:28)">
    <input type="text" id="lat" placeholder="Latitude (अक्षांश)">
    <input type="text" id="lng" placeholder="Longitude (देशांतर)">
    <button onclick="drawKundli()">कुंडली देखें</button>

    <div id="chart-area" style="display:none;">
        <svg viewBox="0 0 300 300" class="kundli-svg">
            <rect width="300" height="300" fill="none" stroke="#333" stroke-width="2"/>
            <line x1="0" y1="0" x2="300" y2="300" class="line"/>
            <line x1="300" y1="0" x2="0" y2="300" class="line"/>
            <line x1="150" y1="0" x2="0" y2="150" class="line"/>
            <line x1="0" y1="150" x2="150" y2="300" class="line"/>
            <line x1="150" y1="300" x2="300" y2="150" class="line"/>
            <line x1="300" y1="150" x2="150" y2="0" class="line"/>
            
            <g id="rashiLayer"></g>
            <g id="planetLayer"></g>
        </svg>
    </div>
</div>

<script>
    const hNames = {"Sun":"सूर्य","Moon":"चंद्र","Mercury":"बुध","Venus":"शुक्र","Mars":"मंगल","Jupiter":"गुरु","Saturn":"शनि","North Node":"राहू","South Node":"केतु","Syzygy":"Sy","Pars Fortuna":"Pa"};

    // सटीक कोर्डिनेट्स: RX/RY राशियों के लिए, PX/PY ग्रहों के लिए
    // उत्तर भारतीय क्रम: 1(Top Mid), 2(Top Left Tri), 3(Bottom Left Tri), 4(Left Mid)...
    const houseCoords = {
        1:  {rx: 150, ry: 75,  px: 150, py: 110}, // लग्न
        2:  {rx: 80,  ry: 45,  px: 45,  py: 55},
        3:  {rx: 45,  ry: 80,  px: 45,  py: 110},
        4:  {rx: 75,  ry: 150, px: 45,  py: 155},
        5:  {rx: 45,  ry: 220, px: 45,  py: 250},
        6:  {rx: 80,  ry: 265, px: 70,  py: 245},
        7:  {rx: 150, ry: 225, px: 150, py: 185},
        8:  {rx: 220, ry: 265, px: 230, py: 245},
        9:  {rx: 265, ry: 220, px: 255, py: 250},
        10: {rx: 225, ry: 150, px: 255, py: 155},
        11: {rx: 265, ry: 80,  px: 255, py: 110},
        12: {rx: 220, ry: 45,  px: 255, py: 55}
    };

    async function drawKundli() {
        const url = `https://hemantpurohit27.pythonanywhere.com/get_kundli?date=${document.getElementById('date').value}&time=${document.getElementById('time').value}&lat=${document.getElementById('lat').value}&lng=${document.getElementById('lng').value}`;
        
        try {
            const res = await fetch(url);
            const result = await res.json();
            
            if (result.status === "success") {
                document.getElementById('chart-area').style.display = 'block';
                const rLayer = document.getElementById('rashiLayer');
                const pLayer = document.getElementById('planetLayer');
                rLayer.innerHTML = ""; pLayer.innerHTML = "";
                
                // लग्न (First House) की राशि
                const startRashi = result.asc_num;

                // 1. राशियों को 1 से 12 के क्रम में सही घरों में सेट करना
                for (let i = 1; i <= 12; i++) {
                    // एंटी-क्लॉकवाइज क्रम का गणित
                    let rNum = ((startRashi + i - 2) % 12) + 1;
                    let c = houseCoords[i];
                    rLayer.innerHTML += `<text x="${c.rx}" y="${c.ry}" class="rashi-text" text-anchor="middle">${rNum}</text>`;
                }

                // 2. ग्रहों को उनकी डिग्री के साथ सेट करना
                const houseCount = {};
                result.data.forEach(p => {
                    if (p.house) {
                        if(!houseCount[p.house]) houseCount[p.house] = 0;
                        let c = houseCoords[p.house];
                        let offset = houseCount[p.house] * 13; // वर्टिकल लिस्टिंग
                        let name = hNames[p.name] || p.name.substring(0,2);
                        let deg = Math.floor(p.degree || 0);
                        
                        pLayer.innerHTML += `<text x="${c.px}" y="${c.py + offset}" class="planet-text" text-anchor="middle">${name} ${deg}°</text>`;
                        houseCount[p.house]++;
                    }
                });
            }
        } catch (e) { alert("Data Fetch Error!"); }
    }
</script>
</body>
</html>
