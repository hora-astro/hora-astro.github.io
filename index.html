<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Vedic Software Pro</title>
    <style>
        :root { --primary: #7c2d12; --accent: #ea580c; --bg: #fffbf0; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .wrapper { max-width: 1300px; margin: auto; background: white; border: 4px double var(--primary); border-radius: 10px; overflow: hidden; box-shadow: 0 0 30px rgba(0,0,0,0.2); }
        
        .top-nav { background: var(--primary); color: white; padding: 15px; text-align: center; border-bottom: 4px solid var(--accent); }
        .input-box { background: #ffedd5; padding: 20px; display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; align-items: flex-end; }
        .input-box div { display: flex; flex-direction: column; }
        label { font-size: 12px; font-weight: bold; margin-bottom: 4px; color: var(--primary); }
        input { padding: 10px; border: 1px solid #c2410c; border-radius: 4px; }
        .btn-calc { background: var(--primary); color: white; border: none; padding: 12px 25px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 16px; }

        .main-content { display: none; padding: 20px; }
        .grid-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        @media (max-width: 900px) { .grid-container { grid-template-columns: 1fr; } }

        .section-card { border: 1px solid #fed7aa; border-radius: 8px; padding: 15px; background: #fffcf5; }
        .section-card h2 { color: var(--primary); text-align: center; font-size: 20px; margin-top: 0; border-bottom: 2px solid #fed7aa; padding-bottom: 10px; }
        
        svg { width: 100%; max-width: 500px; filter: drop-shadow(2px 2px 5px rgba(0,0,0,0.1)); }
        table { width: 100%; border-collapse: collapse; background: white; margin-top: 10px; }
        th, td { border: 1px solid #fed7aa; padding: 10px; text-align: center; font-size: 14px; }
        th { background: #7c2d12; color: white; }
        .status-exalt { color: green; font-weight: bold; }
        .status-debil { color: red; font-weight: bold; }

        .dasha-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; margin-top: 10px; }
        .dasha-item { background: white; border: 1px solid var(--accent); padding: 10px; border-radius: 5px; text-align: center; font-weight: bold; }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="top-nav"><h1>॥ श्री गणेशाय नमः - प्रोफेशनल वैदिक कुंडली सॉफ्टवेयर ॥</h1></div>

    <div class="input-box">
        <div><label>स्थान</label><input type="text" id="city" value="Banswara"></div>
        <div><label>दिनांक</label><input type="date" id="dob" value="1980-03-27"></div>
        <div><label>समय</label><input type="time" id="tob" value="10:30"></div>
        <button class="btn-calc" onclick="generate()">कुंडली देखें</button>
    </div>

    <div id="mainUI" class="main-content">
        <div class="grid-container">
            <div class="section-card">
                <h2>लग्न कुंडली (D-1)</h2>
                <div id="d1Plot"></div>
            </div>

            <div class="section-card">
                <h2>नवांश कुंडली (D-9)</h2>
                <div id="d9Plot"></div>
            </div>

            <div class="section-card" style="grid-column: 1 / -1;">
                <h2>ग्रह स्पष्ट एवं नक्षत्र विवरण</h2>
                <table>
                    <thead>
                        <tr><th>ग्रह</th><th>राशि</th><th>अंश</th><th>नक्षत्र</th><th>चरण</th><th>अवस्था</th></tr>
                    </thead>
                    <tbody id="pTable"></tbody>
                </table>
            </div>

            <div class="section-card" style="grid-column: 1 / -1;">
                <h2>विंशोत्तरी महादशा अनुक्रम</h2>
                <div id="dashaBox" class="dasha-grid"></div>
            </div>
        </div>
    </div>
</div>

<script>
async function generate() {
    const city = document.getElementById('city').value;
    let lat = 23.54, lon = 74.47;
    try {
        const gRes = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${city}`).then(r => r.json());
        if(gRes.length > 0) { lat = gRes[0].lat; lon = gRes[0].lon; }
    } catch(e) {}

    const res = await fetch('https://hemantpurohit27.pythonanywhere.com/calculate', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            date: document.getElementById('dob').value,
            time: document.getElementById('tob').value,
            lat: lat, lon: lon
        })
    }).then(r => r.json());

    if(res.status === 'success') {
        document.getElementById('mainUI').style.display = 'block';
        render(res);
    }
}

function render(data) {
    // 1. Table
    document.getElementById('pTable').innerHTML = data.planets.map(p => `
        <tr>
            <td>${p.name}</td><td>${p.rIdx}</td><td>${p.deg}°</td>
            <td>${p.nak}</td><td>${p.charan}</td>
            <td class="${p.status==='उच्च'?'status-exalt':p.status==='नीच'?'status-debil':''}">${p.status}</td>
        </tr>
    `).join('');

    // 2. Dasha
    document.getElementById('dashaBox').innerHTML = data.dasha_list.map(d => `
        <div class="dasha-item">${d.lord}<br><small>${d.years} वर्ष</small></div>
    `).join('');

    // 3. Charts
    drawDiamond('d1Plot', data.lagna, data.planets, 'rIdx');
    drawDiamond('d9Plot', data.lagna_d9, data.planets, 'd9Idx');
}

function drawDiamond(id, asc, planets, key) {
    const pts = {1:[200,165], 2:[100,75], 3:[50,150], 4:[150,215], 5:[50,285], 6:[100,360], 7:[200,275], 8:[300,360], 9:[350,285], 10:[250,215], 11:[350,150], 12:[300,75]};
    let svg = `<svg viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg" style="background:white;">
        <rect width="400" height="400" fill="none" stroke="#7c2d12" stroke-width="3"/>
        <line x1="0" y1="0" x2="400" y2="400" stroke="#7c2d12"/><line x1="400" y1="0" x2="0" y2="400" stroke="#7c2d12"/>
        <line x1="200" y1="0" x2="0" y2="200" stroke="#7c2d12"/><line x1="200" y1="0" x2="400" y2="200" stroke="#7c2d12"/>
        <line x1="0" y1="200" x2="200" y2="400" stroke="#7c2d12"/><line x1="200" y1="400" x2="400" y2="200" stroke="#7c2d12"/>`;

    for(let i=1; i<=12; i++) {
        let r = (asc + i - 1); if(r > 12) r -= 12;
        svg += `<text x="${pts[i][0]}" y="${pts[i][1]}" fill="red" font-weight="bold" font-size="24" text-anchor="middle">${r}</text>`;
        let pIn = planets.filter(p => p[key] === r);
        pIn.forEach((p, idx) => {
            svg += `<text x="${pts[i][0]}" y="${pts[i][1] + 25 + (idx * 18)}" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">${p.name}</text>`;
        });
    }
    document.getElementById(id).innerHTML = svg + `</svg>`;
}
</script>
</body>
    </html>
