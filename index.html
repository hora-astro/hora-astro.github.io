<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Hora Astro Universal Pro</title>
    <style>
        :root { --gold: #f59e0b; --bg: #0f172a; --panel: #1e293b; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; padding: 20px; }
        .container { max-width: 1100px; margin: auto; }
        .input-card { background: var(--panel); padding: 25px; border-radius: 12px; border: 1px solid #334155; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        input, button { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #475569; background: #020617; color: white; font-size: 16px; }
        button { background: var(--gold); color: black; font-weight: bold; cursor: pointer; border: none; margin-top: 20px; }
        
        #result-area { display: none; margin-top: 30px; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
        
        .chart-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 25px; }
        .chart-box { background: white; padding: 20px; border-radius: 12px; color: black; text-align: center; }
        svg { width: 100%; height: auto; border: 1px solid #ddd; }

        table { width: 100%; margin-top: 30px; border-collapse: collapse; background: var(--panel); border-radius: 8px; overflow: hidden; }
        th, td { border: 1px solid #334155; padding: 12px; text-align: left; }
        th { background: #020617; color: var(--gold); }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align:center; color:var(--gold);">॥ HORA ASTRO UNIVERSAL ENGINE ॥</h1>
    
    <div class="input-card">
        <div class="grid">
            <div><label>तारीख</label><input type="date" id="dob" value="1980-03-27"></div>
            <div><label>समय</label><input type="time" id="tob" value="08:10"></div>
            <div><label>अक्षांश (Lat)</label><input type="text" id="lat" value="23.33"></div>
            <div><label>देशांतर (Lon)</label><input type="text" id="lon" value="74.26"></div>
        </div>
        <button onclick="fetchUniversalData()">सटीक कुंडली जनरेट करें</button>
    </div>

    <div id="loader" style="display:none; text-align:center; margin:20px; color:var(--gold);">API से सटीक गणना लोड हो रही है...</div>

    <div id="result-area">
        <div class="chart-grid">
            <div id="d1-svg" class="chart-box"></div>
            <div id="d9-svg" class="chart-box"></div>
        </div>

        <table>
            <thead>
                <tr><th>ग्रह</th><th>राशि</th><th>अंश (Nirayana)</th><th>नक्षत्र</th><th>स्वामी</th></tr>
            </thead>
            <tbody id="planet-data"></tbody>
        </table>
    </div>
</div>

<script>
async function fetchUniversalData() {
    const dob = document.getElementById('dob').value.split('-');
    const tob = document.getElementById('tob').value.split(':');
    const lat = document.getElementById('lat').value;
    const lon = document.getElementById('lon').value;

    const loader = document.getElementById('loader');
    const result = document.getElementById('result-area');
    
    loader.style.display = 'block';
    result.style.display = 'none';

    // अपनी RapidAPI Key यहाँ डालें
    const apiKey = 'e7b14b21femsh6ee1327b27e7508p108379jsnf36df2f55b20'; 

    const payload = {
        day: parseInt(dob[2]), month: parseInt(dob[1]), year: parseInt(dob[0]),
        hour: parseInt(tob[0]), min: parseInt(tob[1]), lat: parseFloat(lat), lon: parseFloat(lon), tzone: 5.5
    };

    const apiOptions = {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'x-rapidapi-key': apiKey },
        body: JSON.stringify(payload)
    };

    try {
        // 1. ग्रह गणना प्राप्त करें
        const pRes = await fetch('https://vedic-jyotish.p.rapidapi.com/planets/nirayana', apiOptions);
        const planets = await pRes.json();

        // 2. D1 चार्ट प्राप्त करें
        const d1Res = await fetch('https://vedic-jyotish.p.rapidapi.com/horo_chart_draw/d1', apiOptions);
        const d1Data = await d1Res.json();

        // 3. D9 चार्ट प्राप्त करें
        const d9Res = await fetch('https://vedic-jyotish.p.rapidapi.com/horo_chart_draw/d9', apiOptions);
        const d9Data = await d9Res.json();

        // डेटा रेंडर करें
        displayPlanets(planets);
        document.getElementById('d1-svg').innerHTML = "<h3>लग्न कुंडली (D1)</h3>" + d1Data.svg;
        document.getElementById('d9-svg').innerHTML = "<h3>नवमांश कुंडली (D9)</h3>" + d9Data.svg;

        loader.style.display = 'none';
        result.style.display = 'block';
    } catch (error) {
        alert("API Error: कृपया अपनी Key की जांच करें और इंटरनेट कनेक्शन देखें।");
        loader.style.display = 'none';
    }
}

function displayPlanets(data) {
    const tbody = document.getElementById('planet-data');
    tbody.innerHTML = data.map(p => `
        <tr>
            <td>${p.name}</td>
            <td>${p.rashi} (${p.rashi_id})</td>
            <td>${p.full_degree.toFixed(2)}°</td>
            <td>${p.nakshatra}</td>
            <td>${p.nakshatra_lord}</td>
        </tr>
    `).join('');
}
</script>
</body>
</html>
