<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Sateek Professional Kundli Software</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #fdf6e3; margin: 0; padding: 20px; }
        .card { background: white; border: 2px solid #7c2d12; border-radius: 15px; max-width: 1200px; margin: auto; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .header { background: #7c2d12; color: white; text-align: center; padding: 20px; border-bottom: 5px solid #f59e0b; }
        .inputs { display: flex; flex-wrap: wrap; gap: 15px; padding: 20px; background: #ffedd5; justify-content: center; }
        input, button { padding: 12px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; }
        button { background: #ea580c; color: white; border: none; cursor: pointer; font-weight: bold; }
        
        .main-grid { display: none; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px; }
        .chart-box { background: white; border: 1px solid #fed7aa; border-radius: 10px; padding: 15px; text-align: center; }
        svg { width: 100%; max-width: 450px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th { background: #7c2d12; color: white; }
        
        .dasha-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; padding: 20px; }
        .dasha-card { background: #fffbeb; border: 1px solid #f59e0b; padding: 10px; border-radius: 8px; min-width: 100px; text-align: center; font-weight: bold; }
        
        @media (max-width: 850px) { .main-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="card">
    <div class="header"><h1>॥ सटीक यूनिवर्सल प्रोफेशनल कुंडली ॥</h1></div>
    <div class="inputs">
        <input type="text" id="city" placeholder="शहर" value="Jaipur">
        <input type="date" id="dob" value="1980-03-27">
        <input type="time" id="tob" value="10:30">
        <button onclick="getKundli()">कुंडली जनरेट करें</button>
    </div>

    <div id="output" class="main-grid">
        <div style="grid-column: 1 / -1;" class="chart-box">
            <h2 style="color:#7c2d12; margin-top:0;">विंशोत्तरी महादशा अनुक्रम</h2>
            <div id="dashaBox" class="dasha-container"></div>
        </div>

        <div class="chart-box">
            <h2>लग्न कुंडली (D-1)</h2>
            <div id="d1Chart"></div>
        </div>

        <div class="chart-box">
            <h2>नवांश कुंडली (D-9)</h2>
            <div id="d9Chart"></div>
        </div>

        <div class="chart-box" style="grid-column: 1 / -1;">
            <h2>ग्रह स्पष्ट एवं नक्षत्र विवरण</h2>
            <table>
                <thead>
                    <tr><th>ग्रह</th><th>राशि</th><th>अंश</th><th>नक्षत्र</th><th>चरण</th><th>अवस्था</th></tr>
                </thead>
                <tbody id="pBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
async function getKundli() {
    const city = document.getElementById('city').value;
    let lat = 26.91, lon = 75.78;
    try {
        const g = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${city}`).then(r => r.json());
        if(g.length > 0) { lat = g[0].lat; lon = g[0].lon; }
    } catch(e) {}

    const res = await fetch('https://hemantpurohit27.pythonanywhere.com/calculate', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ date: document.getElementById('dob').value, time: document.getElementById('tob').value, lat: lat, lon: lon })
    }).then(r => r.json());

    if(res.status === 'success') {
        document.getElementById('output').style.display = 'grid';
        renderUI(res);
    }
}

function renderUI(data) {
    // 1. Dasha
    document.getElementById('dashaBox').innerHTML = data.dasha.map(d => `<div class="dasha-card">${d.lord}<br><small>${d.years} वर्ष</small></div>`).join('');
    
    // 2. Table
    let rows = `<tr><td><b>लग्न</b></td><td>${data.lagna}</td><td>-</td><td>${data.l_nak}</td><td>${data.l_charan}</td><td>-</td></tr>`;
    rows += data.planets.map(p => `<tr><td>${p.name}</td><td>${p.rIdx}</td><td>${p.deg}°</td><td>${p.nak}</td><td>${p.charan}</td><td>${p.status}</td></tr>`).join('');
    document.getElementById('pBody').innerHTML = rows;

    // 3. Charts
    drawDiamond('d1Chart', data.lagna, data.planets, 'rIdx');
    drawDiamond('d9Chart', data.l_d9, data.planets, 'd9Idx');
}

function drawDiamond(container, asc, planets, key) {
    const pos = {1:[200,165], 2:[100,75], 3:[50,150], 4:[150,215], 5:[50,285], 6:[100,360], 7:[200,275], 8:[300,360], 9:[350,285], 10:[250,215], 11:[350,150], 12:[300,75]};
    let svg = `<svg viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg" style="border:2px solid #7c2d12;">
        <line x1="0" y1="0" x2="400" y2="400" stroke="#7c2d12"/><line x1="400" y1="0" x2="0" y2="400" stroke="#7c2d12"/>
        <line x1="200" y1="0" x2="0" y2="200" stroke="#7c2d12"/><line x1="200" y1="0" x2="400" y2="200" stroke="#7c2d12"/>
        <line x1="0" y1="200" x2="200" y2="400" stroke="#7c2d12"/><line x1="200" y1="400" x2="400" y2="200" stroke="#7c2d12"/>`;

    for(let i=1; i<=12; i++) {
        let r = (asc + i - 1); if(r > 12) r -= 12;
        svg += `<text x="${pos[i][0]}" y="${pos[i][1]}" fill="red" font-weight="bold" font-size="22" text-anchor="middle">${r}</text>`;
        let pIn = planets.filter(p => p[key] === r);
        pIn.forEach((p, idx) => {
            svg += `<text x="${pos[i][0]}" y="${pos[i][1]} + 25 + ${idx * 16}" font-size="13" font-weight="bold" text-anchor="middle" dy="${25 + idx*16}">${p.name}</text>`;
        });
    }
    document.getElementById(container).innerHTML = svg + `</svg>`;
}
</script>
</body>
</html>
