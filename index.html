<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>HORA ASTRO FINAL PRECISION</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body { background: #1a202c; color: white; font-family: sans-serif; text-align: center; }
        .report-card { background: white; color: black; width: 700px; margin: 20px auto; padding: 25px; border: 4px solid #8b0000; display: none; }
        .chart-box { width: 320px; height: 320px; border: 1px solid #000; display: inline-block; background: #fff; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; font-size: 14px; }
        .btn { background: #c05621; color: white; padding: 12px 30px; border: none; cursor: pointer; border-radius: 5px; font-weight: bold; }
    </style>
</head>
<body>

    <h2>üïâÔ∏è ‡§™‡§∞‡§´‡•á‡§ï‡•ç‡§ü ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§á‡§Ç‡§ú‡§® V90.0</h2>
    <div style="margin-bottom: 20px;">
        <input type="date" id="d" value="1980-03-27">
        <input type="time" id="t" value="08:10">
        <button class="btn" onclick="build()">‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§¨‡§®‡§æ‡§è‡§Å</button>
    </div>

    <div id="capture" class="report-card">
        <h2 style="color:#8b0000;">‡•• ‡§ú‡§®‡•ç‡§Æ ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡••</h2>
        <div class="chart-box" id="d1"></div>
        <table id="p-table"></table>
    </div>

<script>
    async function build() {
        const res = await fetch(`https://hemantpurohit27.pythonanywhere.com/api/v90_perfect?date=${document.getElementById('d').value}&time=${document.getElementById('t').value}&lat=24.58&lng=73.71`);
        const data = await res.json();
        
        document.getElementById('capture').style.display = 'block';
        
        // ‡§ö‡§æ‡§∞‡•ç‡§ü ‡§°‡•ç‡§∞‡§æ‡§á‡§Ç‡§ó
        drawChart("d1", data.asc, data.planets);

        // ‡§ü‡•á‡§¨‡§≤ ‡§Ö‡§™‡§°‡•á‡§ü
        let html = `<tr><th>‡§ó‡•ç‡§∞‡§π</th><th>‡§∞‡§æ‡§∂‡§ø</th><th>‡§Ö‡§Ç‡§∂</th><th>‡§≠‡§æ‡§µ (House)</th></tr>`;
        data.planets.forEach(p => {
            html += `<tr><td>${p.name}</td><td>${p.sign}</td><td>${p.deg}¬∞</td><td><b>${p.house}</b></td></tr>`;
        });
        document.getElementById('p-table').innerHTML = html;
    }

    function drawChart(divId, asc, planets) {
        // ‡§≠‡§æ‡§µ‡•ã‡§Ç ‡§ï‡•á ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞ (Coordinates)
        const pos = {
            1:[160,130], 2:[80,60], 3:[40,130], 4:[110,210], 5:[40,280], 6:[80,350],
            7:[160,280], 8:[240,350], 9:[300,280], 10:[210,210], 11:[300,130], 12:[240,60]
        };

        let svg = `<svg viewBox="0 0 350 350" style="width:100%; height:100%;">
            <path d="M0 0 L350 350 M350 0 L0 350 M175 0 L0 175 L175 350 L350 175 Z" fill="none" stroke="black" stroke-width="1.5"/>`;

        for (let h = 1; h <= 12; h++) {
            // ‡§∞‡§æ‡§∂‡§ø ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ (Red) - ‡§≤‡§ó‡•ç‡§® ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞
            let r_val = ((asc + h - 2) % 12) + 1;
            svg += `<text x="${pos[h][0]}" y="${pos[h][1]}" fill="red" font-weight="bold" font-size="16">${r_val}</text>`;

            // ‡§ó‡•ç‡§∞‡§π (Blue) - ‡§ï‡•á‡§µ‡§≤ ‡§â‡§∏ ‡§≠‡§æ‡§µ (h) ‡§ï‡•á ‡§ó‡•ç‡§∞‡§π
            let p_names = planets.filter(p => p.house === h).map(p => p.name).join(' ');
            if(p_names) {
                svg += `<text x="${pos[h][0]}" y="${pos[h][1]+22}" fill="blue" font-size="11" font-weight="bold" text-anchor="middle">${p_names}</text>`;
            }
        }
        document.getElementById(divId).innerHTML = svg + `</svg>`;
    }
</script>
</body>
</html>
