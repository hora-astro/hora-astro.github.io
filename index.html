<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>HORA ASTRO ULTIMATE PRO V150</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { --gold: #b45309; --dark: #0f172a; }
        body { background: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; }
        .dashboard { max-width: 1100px; margin: auto; padding: 20px; }
        .input-panel { background: #1e293b; border: 2px solid var(--gold); border-radius: 15px; padding: 25px; margin-bottom: 30px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .report-card { background: white; color: black; padding: 40px; border-radius: 4px; box-shadow: 0 0 50px rgba(0,0,0,0.5); display: none; }
        .kundli-grid { display: flex; justify-content: space-around; flex-wrap: wrap; margin: 20px 0; }
        .chart-wrap { border: 2px solid #8b0000; padding: 10px; background: #fffaf0; width: 45%; min-width: 350px; }
        input { padding: 12px; border-radius: 8px; border: 1px solid #ccc; width: 100%; box-sizing: border-box; }
        .btn { background: var(--gold); color: white; border: none; padding: 15px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn:hover { background: #92400e; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; border: 2px solid #8b0000; }
        th { background: #8b0000; color: white; padding: 12px; }
        td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        .pred-box { background: #fffbeb; border-left: 8px solid var(--gold); padding: 20px; font-size: 16px; line-height: 1.6; }
    </style>
</head>
<body>

<div class="dashboard">
    <div class="input-panel">
        <input type="text" id="name" placeholder="‡§®‡§æ‡§Æ">
        <input type="text" id="city" placeholder="‡§∏‡•ç‡§•‡§æ‡§® (‡§â‡§¶‡§æ: Banswara)">
        <input type="date" id="date" value="1980-03-27">
        <input type="time" id="time" value="08:10">
        <button class="btn" onclick="generate()">‡§∏‡§ü‡•Ä‡§ï ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</button>
    </div>

    <div id="final-report" class="report-card">
        <div style="text-align:center; border-bottom: 2px solid #8b0000; margin-bottom:20px;">
            <h1 style="color:#8b0000; margin:5px;">‡•• ‡§∂‡•ç‡§∞‡•Ä ‡§ó‡§£‡•á‡§∂‡§æ‡§Ø ‡§®‡§Æ‡§É ‡••</h1>
            <p id="meta-head" style="font-weight:bold; color:#555;"></p>
        </div>

        <div class="kundli-grid">
            <div class="chart-wrap">
                <h3 align="center" style="margin:0; color:#8b0000;">‡§≤‡§ó‡•ç‡§® ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä (D1)</h3>
                <div id="d1"></div>
            </div>
            <div class="chart-wrap">
                <h3 align="center" style="margin:0; color:#8b0000;">‡§®‡§µ‡§æ‡§Ç‡§∂ ‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä (D9)</h3>
                <div id="d9"></div>
            </div>
        </div>

        <h3>üìä ‡§ó‡•ç‡§∞‡§π ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§µ‡§ø‡§µ‡§∞‡§£</h3>
        <table id="p-table"></table>

        <h3>üìú ‡§ú‡•ç‡§Ø‡•ã‡§§‡§ø‡§∑‡•Ä‡§Ø ‡§´‡§≤‡§æ‡§¶‡•á‡§∂ (Dynamic Analysis)</h3>
        <div class="pred-box" id="prediction-list"></div>

        <button onclick="download()" style="margin-top:30px; width:100%; background:#15803d; color:white; padding:15px; border:none; border-radius:8px; cursor:pointer; font-weight:bold;">üì• PDF ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
    </div>
</div>

<script>
    async function generate() {
        const d = document.getElementById('date').value;
        const t = document.getElementById('time').value;
        const res = await fetch(`https://hemantpurohit27.pythonanywhere.com/api/v150_ultra?date=${d}&time=${t}`);
        const data = await res.json();

        document.getElementById('final-report').style.display = 'block';
        document.getElementById('meta-head').innerText = `‡§®‡§æ‡§Æ: ${document.getElementById('name').value} | ‡§∏‡•ç‡§•‡§æ‡§®: ${document.getElementById('city').value} | ‡§§‡§ø‡§•‡§ø: ${d} | ‡§∏‡§Æ‡§Ø: ${t}`;

        draw("d1", data.asc, data.planets);
        draw("d9", 9, data.planets);

        let table = `<tr><th>‡§ó‡•ç‡§∞‡§π</th><th>‡§∞‡§æ‡§∂‡§ø</th><th>‡§Ö‡§Ç‡§∂</th><th>‡§≠‡§æ‡§µ</th></tr>`;
        data.planets.forEach(p => {
            table += `<tr><td>${p.name}</td><td>${p.sign}</td><td>${p.deg}¬∞</td><td><b>${p.house}</b></td></tr>`;
        });
        document.getElementById('p-table').innerHTML = table;

        document.getElementById('prediction-list').innerHTML = data.prediction.map(p => `‚Ä¢ ${p}`).join('<br>');
    }

    function draw(containerId, asc, planets) {
        const pos = { 1:[175,130], 2:[85,60], 3:[40,130], 4:[115,215], 5:[40,290], 6:[85,360], 7:[175,290], 8:[265,360], 9:[310,290], 10:[225,215], 11:[310,130], 12:[265,60] };
        let svg = `<svg viewBox="0 0 350 350" width="100%"><path d="M0 0 L350 350 M350 0 L0 350 M175 0 L0 175 L175 350 L350 175 Z" fill="none" stroke="#8b0000" stroke-width="2.5"/>`;
        for (let h = 1; h <= 12; h++) {
            let sign = ((asc + h - 2) % 12) + 1;
            svg += `<text x="${pos[h][0]}" y="${pos[h][1]}" fill="red" font-weight="bold" font-size="20" text-anchor="middle">${sign}</text>`;
            let names = planets.filter(p => p.house === h).map(p => p.name).join(' ');
            if(names) svg += `<text x="${pos[h][0]}" y="${pos[h][1]+30}" fill="blue" font-size="12" font-weight="bold" text-anchor="middle">${names}</text>`;
        }
        document.getElementById(containerId).innerHTML = svg + `</svg>`;
    }

    function download() {
        html2pdf().from(document.getElementById('final-report')).set({margin: 10, filename: 'Kundli_Report_Pro.pdf'}).save();
    }
</script>
</body>
</html>
